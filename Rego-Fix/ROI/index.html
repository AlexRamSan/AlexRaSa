<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora ROI Toolholding — AlexRaSa</title>
  <meta name="description" content="ROI real por toolholding: holders, collets, nuts, accesorios. Ahorros por ciclo, vida, setups, scrap y tiempos muertos. Payback, TCO, ROI." />
  <meta name="theme-color" content="#111827" />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://alexrasa.store/calculadora-costo-beneficio/" />
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="preload" as="image" href="/assets/hero-industrial.png" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --text:#0f172a;     /* slate-900 */
      --muted:#475569;    /* slate-600 */
      --line:#e5e7eb;     /* gray-200 */
      --soft:#f8fafc;     /* slate-50 */
      --accent:#e30613;   /* rojo industrial (inspirado) */
      --accent2:#111827;  /* casi negro */
      --good:#16a34a;
      --warn:#f59e0b;
      --bad:#dc2626;
    }
    html,body{background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
    a{color:var(--accent);}
    .card{background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:0 10px 30px rgba(2,6,23,0.06);}
    .chip{border:1px solid var(--line); background:var(--soft); border-radius:999px; padding:.25rem .6rem; font-weight:700; font-size:12px; color:var(--muted);}
    input,select,textarea{background:#fff; color:var(--text); border:1px solid var(--line); padding:.55rem .6rem; border-radius:.65rem;}
    input:focus,select:focus{outline:none; box-shadow:0 0 0 4px rgba(227,6,19,0.12); border-color:rgba(227,6,19,0.45);}
    label[title]{cursor:help; text-decoration: underline dotted rgba(15,23,42,.35);}
    #siteHeader{background:rgba(255,255,255,0.88); backdrop-filter: blur(10px); border-bottom:1px solid var(--line);}
    .btn{border-radius:.75rem; font-weight:800; letter-spacing:.01em;}
    .btn-primary{background:var(--accent); color:#fff;}
    .btn-dark{background:var(--accent2); color:#fff;}
    .btn-ghost{background:#fff; border:1px solid var(--line);}
    .kpiBox{border-radius:14px; border:1px solid var(--line); background:linear-gradient(180deg, #ffffff, #fafafa);}
    .stat-badge{display:inline-block; padding:.28rem .66rem; border-radius:999px; font-weight:900; font-size:11px; min-width:64px; text-align:center; line-height:1; border:1px solid rgba(2,6,23,0.08); background:#fff;}
    .badge-up{background:linear-gradient(180deg, #16a34a 0%, #059669 100%); color:#fff; border-color:rgba(5,118,78,0.35);}
    .badge-mid{background:linear-gradient(180deg, #f59e0b 0%, #d97706 100%); color:#101010; border-color:rgba(217,119,6,0.25);}
    .badge-down{background:linear-gradient(180deg, #ef4444 0%, #dc2626 100%); color:#fff; border-color:rgba(220,38,38,0.28);}
    .hero{
      position:relative;
      background: radial-gradient(1200px 600px at 15% 20%, rgba(227,6,19,0.09), transparent 55%),
                  radial-gradient(900px 500px at 85% 10%, rgba(17,24,39,0.06), transparent 55%),
                  linear-gradient(180deg, #ffffff, #f8fafc);
      border-bottom:1px solid var(--line);
      overflow:hidden;
    }
    .hero::after{
      content:"";
      position:absolute; inset:0;
      background-image:url('/assets/hero-industrial.png');
      background-size:cover; background-position:center;
      opacity:.08;
      pointer-events:none;
      mix-blend-mode:multiply;
    }
    .mono{font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}

    /* --- IMPRESIÓN (reporte 1 página) --- */
    @media print{
      @page{size:Letter; margin:0.45in;}
      header, footer, .hero, #mobileBar{display:none !important;}
      html,body{background:#fff !important; color:#000 !important; font-size:8.6pt !important;}
      .card{box-shadow:none !important;}
      #calcGrid{display:block !important; padding:0 !important; margin:0 !important; max-width:100% !important;}
      #reportSection{display:grid !important; grid-template-columns:repeat(3,1fr) !important; gap:.45rem !important;}
      #inputPanel{display:none !important;}
      h2{font-size:1.05rem !important; margin-bottom:.2rem !important;}
      .text-lg{font-size:.92rem !important;}
      .text-sm{font-size:.75rem !important;}
      .min-h-\[320px\]{min-height:150px !important;}
      svg text{font-size:8px !important;}
      .badge-up,.badge-mid,.badge-down{-webkit-print-color-adjust:exact; print-color-adjust:exact;}
    }
  </style>
</head>

<body class="antialiased">
  <header id="siteHeader" class="sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4">
      <div class="h-16 flex items-center justify-between gap-3">
        <a href="/" class="flex items-center gap-3 shrink-0" aria-label="Ir al inicio">
          <img src="/assets/logo.png" alt="Logo AlexRaSa" class="h-9 w-auto" width="150" height="36" />
          <span class="hidden sm:inline text-[15px] font-extrabold tracking-tight">AlexRaSa<span style="color:var(--accent)">.store</span></span>
          <span class="hidden md:inline chip">ROI Toolholding</span>
        </a>

        <nav class="hidden lg:flex items-center gap-6 text-sm font-semibold" style="color:var(--muted)">
          <a href="/" class="hover:opacity-80">Inicio</a>
          <a href="/SolidCAM/" class="hover:opacity-80">Soluciones</a>
          <a href="/#servicios" class="hover:opacity-80">Servicios</a>
          <a href="/#recursos" class="hover:opacity-80">Recursos</a>
          <a href="/#contacto" class="hover:opacity-80">Contacto</a>
        </nav>

        <!-- Logo REGO-FIX opcional (solo si tienes permiso) -->
        <div class="hidden md:flex items-center gap-2">
          <img src="/assets/brand/rego-fix.svg" alt="REGO-FIX (opcional)" class="h-6 opacity-80" onerror="this.style.display='none';" />
        </div>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="max-w-7xl mx-auto px-4 py-10 md:py-14 relative">
      <div class="max-w-4xl">
        <p class="chip inline-flex items-center gap-2">
          <span class="h-2 w-2 rounded-full" style="background:var(--accent)"></span>
          ROI basado en holders + componentes
        </p>
        <h1 class="mt-3 text-3xl md:text-5xl font-black leading-tight">
          Calculadora de <span style="color:var(--accent)">ROI</span> para <span class="whitespace-nowrap">Toolholding</span>
        </h1>
        <p class="mt-3 text-base md:text-lg" style="color:var(--muted)">
          Modela <b>CAPEX por items</b> (holders, collets, nuts, accesorios) y cuantifica ahorros por
          <b>ciclo</b>, <b>vida</b>, <b>setups</b>, <b>scrap</b> y <b>tiempos muertos</b>. Reporte imprimible.
        </p>
        <div class="mt-5 flex flex-wrap gap-2">
          <span class="chip">ROI</span>
          <span class="chip">Payback</span>
          <span class="chip">TCO</span>
          <span class="chip">Micras → dinero</span>
        </div>
      </div>
    </div>
  </section>

  <main id="calcGrid" class="max-w-7xl mx-auto px-4 pt-7 pb-24 grid gap-5 lg:grid-cols-12">
    <!-- INPUT PANEL -->
    <section id="inputPanel" class="card p-5 lg:col-span-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-lg font-black">Entradas</h2>
          <p class="text-sm" style="color:var(--muted)">Todo en USD por default (puedes cambiarlo).</p>
        </div>
        <button id="btnPrint" class="btn btn-ghost px-3 py-2 text-sm">Reporte (PDF)</button>
      </div>

      <!-- Moneda -->
      <div class="mt-4 grid gap-3">
        <div class="grid grid-cols-3 gap-2">
          <label class="text-sm col-span-1" title="Moneda para mostrar resultados.">
            Moneda
            <select id="moneda" class="mt-1 w-full">
              <option value="USD" selected>USD</option>
              <option value="MXN">MXN</option>
            </select>
          </label>
          <label class="text-sm col-span-2" title="Tipo de cambio solo para visualización (si eliges MXN).">
            TC (MXN/USD)
            <input id="tc" type="number" value="17.00" class="mt-1 w-full" />
          </label>
        </div>

        <!-- Producción / costos base -->
        <div class="grid grid-cols-2 gap-2">
          <label class="text-sm" title="Volumen mensual del proceso analizado.">
            Piezas/mes
            <input id="pmes" type="number" value="10000" class="mt-1 w-full">
          </label>
          <label class="text-sm" title="Costo total de operar la máquina por hora (incluye MO, energía, etc.).">
            Costo hora máquina
            <input id="costoHora" type="number" value="50" class="mt-1 w-full">
          </label>
        </div>

        <!-- Baseline vs propuesta (ciclo, vida, muertos) -->
        <div class="grid grid-cols-2 gap-2">
          <label class="text-sm" title="Tiempo de ciclo actual por pieza (s).">
            Ciclo actual (s)
            <input id="cicloA" type="number" value="60" class="mt-1 w-full">
          </label>
          <label class="text-sm" title="Tiempo de ciclo propuesto por pieza (s).">
            Ciclo propuesto (s)
            <input id="cicloP" type="number" value="45" class="mt-1 w-full">
          </label>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <label class="text-sm" title="Vida útil actual del filo/herramienta (pzas).">
            Vida actual (pzas)
            <input id="vidaA" type="number" value="1300" class="mt-1 w-full">
          </label>
          <label class="text-sm" title="Vida útil propuesta (pzas).">
            Vida propuesta (pzas)
            <input id="vidaP" type="number" value="2500" class="mt-1 w-full">
          </label>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <label class="text-sm" title="Costo del inserto/herramienta por reemplazo.">
            Costo herramienta
            <input id="costoHerr" type="number" value="128.87" class="mt-1 w-full">
          </label>
          <label class="text-sm" title="Minutos totales de paro/tiempos muertos al mes.">
            T. muerto actual (min/mes)
            <input id="tmuertoA" type="number" value="120" class="mt-1 w-full">
          </label>
        </div>

        <label class="text-sm" title="Minutos de paro objetivo con la propuesta.">
          T. muerto propuesto (min/mes)
          <input id="tmuertoP" type="number" value="30" class="mt-1 w-full">
        </label>

        <!-- Setups y scrap (del PDF) -->
        <div class="mt-2 pt-3 border-t" style="border-color:var(--line)">
          <h3 class="text-sm font-extrabold">Setups + Scrap</h3>

          <div class="grid grid-cols-2 gap-2 mt-2">
            <label class="text-sm" title="Minutos totales al mes dedicados a setups/cambios (baseline).">
              Setup actual (min/mes)
              <input id="setupA" type="number" value="180" class="mt-1 w-full">
            </label>
            <label class="text-sm" title="Minutos totales al mes dedicados a setups/cambios (propuesta).">
              Setup propuesto (min/mes)
              <input id="setupP" type="number" value="120" class="mt-1 w-full">
            </label>
          </div>

          <div class="grid grid-cols-3 gap-2 mt-2">
            <label class="text-sm" title="Scrap actual del proceso (%).">
              Scrap A (%)
              <input id="scrapA" type="number" value="2.0" step="0.1" class="mt-1 w-full">
            </label>
            <label class="text-sm" title="Scrap propuesto (%).">
              Scrap P (%)
              <input id="scrapP" type="number" value="0.8" step="0.1" class="mt-1 w-full">
            </label>
            <label class="text-sm" title="Costo de scrap por pieza (material + proceso + logística).">
              Costo scrap/pza
              <input id="costoScrap" type="number" value="3.50" step="0.1" class="mt-1 w-full">
            </label>
          </div>
        </div>

        <!-- Toolholding REGO-FIX (items) -->
        <div class="mt-2 pt-3 border-t" style="border-color:var(--line)">
          <div class="flex items-center justify-between gap-2">
            <h3 class="text-sm font-extrabold">Paquete Toolholding (items)</h3>
            <span class="chip">CAPEX por lista</span>
          </div>

          <div class="grid grid-cols-2 gap-2 mt-2">
            <label class="text-sm" title="Sistema de sujeción a evaluar.">
              Sistema
              <select id="sistema" class="mt-1 w-full">
                <option value="POWRGRIP" selected>powRgrip</option>
                <option value="MICRUN">micRun</option>
                <option value="ER_STD">ER estándar</option>
                <option value="ER_UP">ER ultra precision</option>
                <option value="UNITEC">uniTec (manual)</option>
              </select>
            </label>
            <label class="text-sm" title="Interfaz del husillo (afecta qué holders compras).">
              Interfaz husillo
              <select id="interfaz" class="mt-1 w-full">
                <option>HSK</option><option>BT</option><option>SK</option><option>CAT</option><option>CAPTO</option><option>CYL</option>
              </select>
            </label>
          </div>

          <!-- Micras a dinero -->
          <div class="grid grid-cols-2 gap-2 mt-2">
            <label class="text-sm" title="Runout (TIR) actual en micras. Si no lo mides: empieza con 10–20 µm y afina después.">
              Runout actual (µm)
              <input id="runoutA" type="number" value="12" step="0.5" class="mt-1 w-full">
            </label>
            <label class="text-sm" title="Runout objetivo. Se autocompleta por sistema y puedes ajustarlo.">
              Runout propuesto (µm)
              <input id="runoutP" type="number" value="3" step="0.5" class="mt-1 w-full">
            </label>
          </div>
          <div class="grid grid-cols-2 gap-2 mt-2">
            <label class="text-sm" title="Impacto estimado por micra de mejora en runout sobre vida (%/µm). Ajusta con tus datos.">
              Vida: % por µm
              <input id="kVidaPorUm" type="number" value="1.0" step="0.1" class="mt-1 w-full">
            </label>
            <label class="text-sm" title="Impacto estimado por micra en scrap (puntos porcentuales / µm). Ajusta con tu historial.">
              Scrap: pp por µm
              <input id="kScrapPorUm" type="number" value="0.05" step="0.01" class="mt-1 w-full">
            </label>
          </div>

          <!-- Lista de items (CAPEX) -->
          <div class="mt-3 grid gap-2">
            <p class="text-xs font-bold uppercase tracking-wide" style="color:var(--muted)">Items (cantidad × costo unitario)</p>

            <div class="grid grid-cols-3 gap-2">
              <label class="text-sm col-span-2" title="Cuerpos/holders según interfaz (HSK/BT/etc.).">
                Holders (cuerpos)
                <input id="qtyHolder" type="number" value="6" class="mt-1 w-full">
              </label>
              <label class="text-sm" title="Costo unitario del holder.">
                $/Holder
                <input id="uHolder" type="number" value="320" class="mt-1 w-full">
              </label>
            </div>

            <div class="grid grid-cols-3 gap-2">
              <label class="text-sm col-span-2" title="Collets/pinzas (powRgrip, micRun, ER).">
                Collets
                <input id="qtyCollet" type="number" value="10" class="mt-1 w-full">
              </label>
              <label class="text-sm" title="Costo unitario de collet.">
                $/Collet
                <input id="uCollet" type="number" value="55" class="mt-1 w-full">
              </label>
            </div>

            <div class="grid grid-cols-3 gap-2">
              <label class="text-sm col-span-2" title="Tuercas de apriete / nuts.">
                Nuts
                <input id="qtyNut" type="number" value="6" class="mt-1 w-full">
              </label>
              <label class="text-sm" title="Costo unitario de nut.">
                $/Nut
                <input id="uNut" type="number" value="48" class="mt-1 w-full">
              </label>
            </div>

            <div class="grid grid-cols-3 gap-2">
              <label class="text-sm col-span-2" title="Pull studs / pernos de retención (si aplica).">
                Pull studs
                <input id="qtyPull" type="number" value="6" class="mt-1 w-full">
              </label>
              <label class="text-sm" title="Costo unitario de pull stud.">
                $/Pull
                <input id="uPull" type="number" value="22" class="mt-1 w-full">
              </label>
            </div>

            <div class="grid grid-cols-3 gap-2">
              <label class="text-sm col-span-2" title="Accesorios (discos sellado, flush disks, llaves, etc.).">
                Accesorios
                <input id="qtyAcc" type="number" value="8" class="mt-1 w-full">
              </label>
              <label class="text-sm" title="Costo unitario promedio de accesorio.">
                $/Acc
                <input id="uAcc" type="number" value="18" class="mt-1 w-full">
              </label>
            </div>

            <div class="grid grid-cols-3 gap-2">
              <label class="text-sm col-span-2" title="Equipo/servicio recurrente (limpieza, calibración, consumibles, etc.).">
                OPEX mensual (toolholding)
                <input id="opex" type="number" value="0" class="mt-1 w-full">
              </label>
              <label class="text-sm" title="Cuota/suscripción/mantenimiento (si aplica aparte).">
                Mensualidad
                <input id="mensualidad" type="number" value="0" class="mt-1 w-full">
              </label>
            </div>

            <div class="kpiBox p-3 mt-1">
              <div class="text-xs font-extrabold uppercase tracking-wide" style="color:var(--muted)">CAPEX calculado (items)</div>
              <div id="capexCalc" class="text-2xl font-black mt-1">$0</div>
              <div class="text-xs mt-1" style="color:var(--muted)">Si quieres forzar inversión, usa el override.</div>

              <label class="mt-2 inline-flex items-center gap-2 text-sm font-semibold">
                <input id="capexOverrideOn" type="checkbox" class="h-4 w-4">
                Override inversión
              </label>
              <input id="capexOverride" type="number" value="2000" class="mt-2 w-full" disabled>
            </div>
          </div>
        </div>

        <!-- Inclusiones -->
        <div class="mt-2 pt-3 border-t" style="border-color:var(--line)">
          <h3 class="text-sm font-extrabold">Ahorros a incluir</h3>
          <div class="grid grid-cols-2 gap-2 text-sm mt-2">
            <label class="inline-flex items-center gap-2"><input id="incCiclo" type="checkbox" checked class="h-4 w-4"><span>Tiempo de ciclo</span></label>
            <label class="inline-flex items-center gap-2"><input id="incHerr" type="checkbox" checked class="h-4 w-4"><span>Vida herramienta</span></label>
            <label class="inline-flex items-center gap-2"><input id="incTM" type="checkbox" checked class="h-4 w-4"><span>Tiempo muerto</span></label>
            <label class="inline-flex items-center gap-2"><input id="incSetup" type="checkbox" checked class="h-4 w-4"><span>Setups/cambios</span></label>
            <label class="inline-flex items-center gap-2"><input id="incScrap" type="checkbox" checked class="h-4 w-4"><span>Scrap</span></label>
            <label class="inline-flex items-center gap-2"><input id="incMicras" type="checkbox" checked class="h-4 w-4"><span>Micras→$ (auto)</span></label>
          </div>

          <button id="btnCalcular" class="btn btn-primary w-full px-4 py-3 mt-3">Calcular</button>

          <p class="text-xs mt-3" style="color:var(--muted)">
            Nota: micras→$ aplica “boost” a vida y scrap según tus coeficientes. No es magia: es un dial para aterrizar runout a impacto real.
          </p>
        </div>
      </div>
    </section>

    <!-- REPORT -->
    <div id="reportSection" class="lg:col-span-8 grid gap-5 lg:grid-cols-8">
      <section class="card p-5 lg:col-span-5">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h2 class="text-lg font-black">Comparativa A vs P</h2>
            <p class="text-sm" style="color:var(--muted)">Incluye items de toolholding + KPIs financieros.</p>
          </div>
          <span class="chip" id="sysBadge">powRgrip</span>
        </div>

        <div class="mt-3 overflow-auto -mx-2 sm:mx-0">
          <table class="w-full border-separate [border-spacing:0_8px] text-sm">
            <thead>
              <tr style="color:var(--muted)">
                <th class="text-left font-bold px-2">Métrica</th>
                <th class="text-right font-bold px-2">Actual</th>
                <th class="text-right font-bold px-2">Propuesta</th>
                <th class="text-right font-bold px-2">Δ</th>
              </tr>
            </thead>
            <tbody id="tbodyComp"></tbody>
          </table>
        </div>

        <div class="mt-3 grid md:grid-cols-2 gap-3">
          <div class="kpiBox p-4">
            <div class="text-xs font-extrabold uppercase tracking-wide" style="color:var(--muted)">TCO (12m)</div>
            <div id="tco" class="text-2xl font-black mt-1">$0</div>
            <div class="text-xs mt-1" style="color:var(--muted)">CAPEX + (OPEX+mensualidad)×12</div>
          </div>
          <div class="kpiBox p-4">
            <div class="text-xs font-extrabold uppercase tracking-wide" style="color:var(--muted)">Ahorro anual (neto)</div>
            <div id="ahorroAnualNeto" class="text-2xl font-black mt-1">$0</div>
            <div class="text-xs mt-1" style="color:var(--muted)"> (Ahorro bruto − OPEX − mensualidad)×12</div>
          </div>
        </div>
      </section>

      <section class="card p-5 lg:col-span-3">
        <h2 class="text-lg font-black">Resultados</h2>

        <div class="mt-3 grid gap-3">
          <div class="kpiBox p-4">
            <div class="text-sm font-bold" style="color:var(--muted)">Ahorro mensual (bruto)</div>
            <div id="ahorro" class="text-right font-black text-2xl" style="color:var(--good)">$0</div>
          </div>

          <div class="kpiBox p-4">
            <div class="text-sm font-bold" style="color:var(--muted)">Neto mensual</div>
            <div id="netoMensual" class="text-right font-black text-xl">$0</div>
            <div class="text-xs mt-1 text-right" style="color:var(--muted)">Neto = ahorro − OPEX − mensualidad</div>
          </div>

          <div class="kpiBox p-4">
            <div class="text-sm font-bold" style="color:var(--muted)">ROI anual</div>
            <div id="roi" class="text-right font-black text-xl">0%</div>
          </div>

          <div class="kpiBox p-4">
            <div class="text-sm font-bold" style="color:var(--muted)">Payback</div>
            <div id="payback" class="text-right font-black text-xl">—</div>
            <div class="text-xs mt-1 text-right" style="color:var(--muted)">en meses (aprox)</div>
          </div>

          <div class="kpiBox p-4">
            <div class="text-sm font-bold" style="color:var(--muted)">Ahorro por scrap (mes)</div>
            <div id="ahorroScrap" class="text-right font-black text-lg">$0</div>
          </div>

          <div class="kpiBox p-4">
            <div class="text-sm font-bold" style="color:var(--muted)">Ahorro por setups (mes)</div>
            <div id="ahorroSetup" class="text-right font-black text-lg">$0</div>
          </div>

          <div class="kpiBox p-4">
            <div class="text-sm font-bold" style="color:var(--muted)">Ahorro por tiempo muerto (mes)</div>
            <div id="ahorroTM" class="text-right font-black text-lg">$0</div>
          </div>
        </div>
      </section>

      <section class="card p-5 lg:col-span-8">
        <h2 class="text-lg font-black">Visuales</h2>
        <div class="mt-3 grid grid-cols-1 gap-6">
          <div class="rounded-xl p-4" style="border:1px solid var(--line); background:#fff;">
            <p class="text-sm font-extrabold">Distribución de ahorros</p>
            <div id="vizAhorros" class="mt-3 min-h-[320px]"></div>
          </div>
          <div class="rounded-xl p-4" style="border:1px solid var(--line); background:#fff;">
            <p class="text-sm font-extrabold">Comparativa rápida</p>
            <div id="vizPerf" class="mt-3"></div>
          </div>
          <div class="rounded-xl p-4" style="border:1px solid var(--line); background:#fff;">
            <p class="text-sm font-extrabold">Flujo mensual y payback</p>
            <div id="vizCash" class="mt-3 min-h-[320px]"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <div id="mobileBar" class="lg:hidden fixed inset-x-0 bottom-0 z-40 px-4 py-3" style="background:rgba(255,255,255,0.92); border-top:1px solid var(--line); backdrop-filter: blur(10px);">
    <button id="btnCalcularMobile" class="btn btn-primary w-full px-4 py-3">Calcular</button>
  </div>

  <footer class="py-8 text-center">
    <div class="max-w-7xl mx-auto px-4 text-sm" style="color:var(--muted)">
      © 2026 AlexRaSa — ROI para decisiones técnicas.
    </div>
  </footer>

  <script>
    // ========= utils =========
    const $ = (id)=>document.getElementById(id);
    const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));
    const fmt = (n)=>Number(n||0).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
    const fmt0 = (n)=>Number(n||0).toLocaleString('en-US',{maximumFractionDigits:0});
    const isNum = (v)=>Number.isFinite(v) && !Number.isNaN(v);

    function money(n){
      const cur = $('moneda').value;
      const tc = +$('tc').value || 1;
      const v = (cur === 'MXN') ? (n * tc) : n;
      const sym = (cur === 'MXN') ? '$' : '$';
      return sym + fmt(v);
    }

    // ========= sistema -> runout por defecto (según REGO-FIX) =========
    // powRgrip TIR ≤ 3 µm @ 3xD :contentReference[oaicite:5]{index=5}
    // ER estándar 10 µm :contentReference[oaicite:6]{index=6}
    // ER-UP 5 µm :contentReference[oaicite:7]{index=7}
    // micRun TIR ≤ 3 µm :contentReference[oaicite:8]{index=8}
    const SYS_RUNOUT = {
      POWRGRIP: 3,
      MICRUN: 3,
      ER_STD: 10,
      ER_UP: 5,
      UNITEC: 3 // manual: deja 3 como placeholder editable
    };

    function syncRunoutBySystem(){
      const sys = $('sistema').value;
      const v = SYS_RUNOUT[sys] ?? 3;
      $('runoutP').value = v;
      $('sysBadge').textContent = $('sistema').options[$('sistema').selectedIndex].text;
    }

    // ========= CAPEX por items =========
    function calcCapex(){
      const qtyHolder = +$('qtyHolder').value || 0;
      const uHolder = +$('uHolder').value || 0;
      const qtyCollet = +$('qtyCollet').value || 0;
      const uCollet = +$('uCollet').value || 0;
      const qtyNut = +$('qtyNut').value || 0;
      const uNut = +$('uNut').value || 0;
      const qtyPull = +$('qtyPull').value || 0;
      const uPull = +$('uPull').value || 0;
      const qtyAcc = +$('qtyAcc').value || 0;
      const uAcc = +$('uAcc').value || 0;

      const capex = (qtyHolder*uHolder) + (qtyCollet*uCollet) + (qtyNut*uNut) + (qtyPull*uPull) + (qtyAcc*uAcc);
      $('capexCalc').textContent = money(capex);
      return capex;
    }

    function capexEffective(){
      const capex = calcCapex();
      const on = $('capexOverrideOn').checked;
      $('capexOverride').disabled = !on;
      return on ? (+$('capexOverride').value || 0) : capex;
    }

    // ========= inclusiones enable/disable =========
    function setEnabled(ids,on){ ids.forEach(id=>{ const el=$(id); if(el) el.disabled=!on; }); }
    function applyInclusions(){
      setEnabled(['cicloA','cicloP'], $('incCiclo').checked);
      setEnabled(['vidaA','vidaP','costoHerr'], $('incHerr').checked);
      setEnabled(['tmuertoA','tmuertoP'], $('incTM').checked);
      setEnabled(['setupA','setupP'], $('incSetup').checked);
      setEnabled(['scrapA','scrapP','costoScrap'], $('incScrap').checked);
      setEnabled(['runoutA','runoutP','kVidaPorUm','kScrapPorUm'], $('incMicras').checked);
    }

    // ========= core calculator =========
    function calcular(){
      // base
      const pmes = +$('pmes').value || 0;
      const costoHora = +$('costoHora').value || 0;

      const cicloA = +$('cicloA').value || 0;
      const cicloP = +$('cicloP').value || 0;

      let vidaA = +$('vidaA').value || 0;
      let vidaP = +$('vidaP').value || 0;

      const costoHerr = +$('costoHerr').value || 0;

      const tmuertoA = +$('tmuertoA').value || 0;
      const tmuertoP = +$('tmuertoP').value || 0;

      const setupA = +$('setupA').value || 0;
      const setupP = +$('setupP').value || 0;

      let scrapA = +$('scrapA').value || 0;
      let scrapP = +$('scrapP').value || 0;
      const costoScrap = +$('costoScrap').value || 0;

      const opex = +$('opex').value || 0;
      const mensualidad = +$('mensualidad').value || 0;
      const capex = capexEffective();

      // micras -> boosts (configurable)
      if($('incMicras').checked){
        const runoutA = +$('runoutA').value || 0;
        const runoutP = +$('runoutP').value || 0;
        const dUm = Math.max(0, runoutA - runoutP); // mejora en µm (solo si baja)

        const kVida = +$('kVidaPorUm').value || 0;       // % por µm
        const kScrap = +$('kScrapPorUm').value || 0;     // puntos porcentuales por µm

        // boost a vida propuesta
        if(vidaP > 0 && dUm > 0 && kVida > 0){
          const mult = 1 + (dUm * kVida / 100);
          vidaP = vidaP * mult;
        }

        // boost a scrap propuesto (reduce)
        if(dUm > 0 && kScrap > 0){
          scrapP = Math.max(0, scrapP - (dUm * kScrap));
        }
      }

      // ahorros
      const incCiclo = $('incCiclo').checked;
      const incHerr  = $('incHerr').checked;
      const incTM    = $('incTM').checked;
      const incSetup = $('incSetup').checked;
      const incScrap = $('incScrap').checked;

      // ciclo: ahorro = (horas actuales - horas propuestas) * costoHora
      const horasA = (pmes * cicloA) / 3600;
      const horasP = (pmes * cicloP) / 3600;
      const ahorroCiclo = (cicloA>0 && cicloP>0) ? Math.max(0, (horasA - horasP) * costoHora) : 0;

      // herramienta
      const consA = (vidaA>0) ? (pmes / vidaA) : 0;
      const consP = (vidaP>0) ? (pmes / vidaP) : 0;
      const costoHerrA = consA * costoHerr;
      const costoHerrP = consP * costoHerr;
      const ahorroHerr = Math.max(0, costoHerrA - costoHerrP);

      // tiempos muertos y setups (min -> horas)
      const ahorroTM = Math.max(0, (tmuertoA - tmuertoP)) / 60 * costoHora;
      const ahorroSetup = Math.max(0, (setupA - setupP)) / 60 * costoHora;

      // scrap (puntos porcentuales)
      const scrapDelta = Math.max(0, (scrapA - scrapP)) / 100;
      const ahorroScrap = scrapDelta * pmes * costoScrap;

      const ahorroBruto = Math.max(0,
        (incCiclo ? ahorroCiclo : 0) +
        (incHerr  ? ahorroHerr  : 0) +
        (incTM    ? ahorroTM    : 0) +
        (incSetup ? ahorroSetup : 0) +
        (incScrap ? ahorroScrap : 0)
      );

      const neto = ahorroBruto - opex - mensualidad;

      const roiAnual = capex > 0 ? ((neto * 12) / capex) * 100 : (neto > 0 ? Infinity : 0);
      const paybackMeses = (capex > 0 && neto > 0) ? (capex / neto) : Infinity;

      // TCO 12m
      const tco = capex + (opex + mensualidad) * 12;
      const ahorroAnualNeto = neto * 12;

      // UI results
      $('ahorro').textContent = money(ahorroBruto);
      $('netoMensual').textContent = money(neto);
      $('netoMensual').style.color = (neto >= 0) ? 'var(--good)' : 'var(--bad)';

      $('roi').textContent = isFinite(roiAnual) ? (fmt(roiAnual) + '%') : '∞%';
      $('payback').textContent = isFinite(paybackMeses) ? (fmt(paybackMeses) + ' meses') : '—';

      $('ahorroTM').textContent = money(ahorroTM);
      $('ahorroSetup').textContent = money(ahorroSetup);
      $('ahorroScrap').textContent = money(ahorroScrap);

      $('tco').textContent = money(tco);
      $('ahorroAnualNeto').textContent = money(ahorroAnualNeto);

      // tabla comparativa
      const pphA = cicloA>0 ? 3600/cicloA : 0;
      const pphP = cicloP>0 ? 3600/cicloP : 0;
      const costPerPieceA = vidaA>0 ? (costoHerr/vidaA) : 0;
      const costPerPieceP = vidaP>0 ? (costoHerr/vidaP) : 0;

      function delta(a,p,{higherIsBetter=true}={}){
        if(!isNum(a) || !isNum(p)) return {val:0};
        if(a===0 && p===0) return {val:0};
        const d = (p-a) / (a===0 ? 1 : a) * 100;
        return {val:d, higherIsBetter};
      }

      function row(name,a,p,opt){
        const d = delta(a,p,opt||{});
        const displayed = isFinite(d.val) ? (d.val >= 0 ? '+' : '') + fmt(d.val) + '%' : '—';
        const thresholdPct = 3;
        const absVal = Math.abs(d.val || 0);
        const higherIsBetter = (opt && typeof opt.higherIsBetter !== 'undefined') ? opt.higherIsBetter : true;
        const isImprovement = higherIsBetter ? (d.val > 0) : (d.val < 0);

        let badgeClass;
        if (absVal < thresholdPct) badgeClass = 'badge-mid';
        else badgeClass = isImprovement ? 'badge-up' : 'badge-down';

        const badge = `<span class="stat-badge ${badgeClass}">${displayed}</span>`;
        return `<tr style="background:#fff; border-bottom:1px solid rgba(2,6,23,0.04);">
          <td class="px-2 py-2">${name}</td>
          <td class="px-2 py-2 text-right mono">${isFinite(a)?fmt(a):'—'}</td>
          <td class="px-2 py-2 text-right mono">${isFinite(p)?fmt(p):'—'}</td>
          <td class="px-2 py-2 text-right">${badge}</td>
        </tr>`;
      }

      const capexShow = capex;
      const runoutA = +$('runoutA').value || 0;
      const runoutP = +$('runoutP').value || 0;

      $('tbodyComp').innerHTML = [
        row('Tiempo de ciclo (s)', cicloA, cicloP, {higherIsBetter:false}),
        row('Piezas por hora', pphA, pphP, {higherIsBetter:true}),
        row('Vida útil (pzas)', vidaA, vidaP, {higherIsBetter:true}),
        row('Costo herramienta/pza', costPerPieceA, costPerPieceP, {higherIsBetter:false}),
        row('Tiempo muerto (min/mes)', tmuertoA, tmuertoP, {higherIsBetter:false}),
        row('Setups (min/mes)', setupA, setupP, {higherIsBetter:false}),
        row('Scrap (%)', scrapA, scrapP, {higherIsBetter:false}),
        row('Runout (µm)', runoutA, runoutP, {higherIsBetter:false}),
        row('CAPEX (items)', 0, capexShow, {higherIsBetter:true}),
        row('Ahorro bruto mensual', 0, ahorroBruto, {higherIsBetter:true}),
        row('Neto mensual', 0, neto, {higherIsBetter:true}),
      ].join('');

      // visuals
      const parts=[], labels=[];
      if(incCiclo) { parts.push(Math.max(0, ahorroCiclo)); labels.push('Ciclo'); }
      if(incHerr)  { parts.push(Math.max(0, ahorroHerr));  labels.push('Herramienta'); }
      if(incTM)    { parts.push(Math.max(0, ahorroTM));    labels.push('Tiempo muerto'); }
      if(incSetup) { parts.push(Math.max(0, ahorroSetup)); labels.push('Setups'); }
      if(incScrap) { parts.push(Math.max(0, ahorroScrap)); labels.push('Scrap'); }

      renderDonut('vizAhorros', parts, labels);

      renderBars('vizPerf', [
        ['T. Ciclo (s)', cicloA, cicloP, true],
        ['Pzas/h', pphA, pphP, false],
        ['Vida útil (pzas)', vidaA, vidaP, false],
        ['Scrap (%)', scrapA, scrapP, true],
      ]);

      renderCashflow('vizCash', {
        ahorroMes: ahorroBruto,
        cuota: (mensualidad + opex),
        capex: capex
      });
    }

    // ========= charts =========
    function renderCashflow(targetId, {ahorroMes, cuota, capex}){
      const el=$(targetId); if(!el) return;
      const meses=Array.from({length:12},(_,i)=>`M${i+1}`);

      const W=800, H=400;
      const pad={top:40,right:10,bottom:50,left:60};
      const barW=18, barGap=6, gap=38;
      const H_drawable = H - pad.top - pad.bottom;

      const neto = (ahorroMes||0) - (cuota||0);
      let acc = -capex;
      const accArr = meses.map(()=>{ acc += neto; return acc; });

      const allValues=[ahorroMes||0, cuota||0, ...accArr, -capex];
      const dataMax = Math.max(1, ...allValues.map(v=>Math.max(0,v)));
      const dataMin = Math.min(0, ...allValues.map(v=>Math.min(0,v)));
      const totalRange = dataMax - dataMin;

      const scaleY=(v)=>{
        if(totalRange===0) return H-pad.bottom;
        return (H-pad.bottom) - (((v-dataMin)/totalRange)*H_drawable);
      };

      const yZero=scaleY(0);

      let x=pad.left + gap/2;
      const bars = meses.map((m,i)=>{
        const yA=scaleY(ahorroMes); const hA=yZero-yA;
        const yP=scaleY(cuota);     const hP=yZero-yP;
        const xa=x, xp=x+barW+barGap;
        const labelY=H-pad.bottom+20;

        const rects = `
          <rect x="${xa}" y="${yA}" width="${barW}" height="${hA}" fill="#16a34a"></rect>
          <rect x="${xp}" y="${yP}" width="${barW}" height="${hP}" fill="#e30613"></rect>
        `;
        const txt = `<text x="${x+barW+barGap/2}" y="${labelY}" font-size="14" fill="var(--text)" text-anchor="middle">${m}</text>`;
        x += (barW*2 + barGap + gap);
        return rects+txt;
      }).join('');

      const linePts = accArr.map((v,i)=>{
        const xi = pad.left + gap/2 + i*(barW*2+barGap+gap) + (barW+barGap/2);
        const yi = scaleY(v);
        return `${xi},${yi}`;
      }).join(' ');

      const x0 = pad.left + gap/2 - (barW*2+barGap+gap) + (barW+barGap/2);
      const y0 = scaleY(-capex);

      const polyline = `<polyline points="${x0},${y0} ${linePts}" fill="none" stroke="#111827" stroke-width="3" opacity="0.35"></polyline>`;

      let marker='';
      if(capex>0){
        const idx = accArr.findIndex(v=>v>=0);
        if(idx!==-1){
          const xi = pad.left + gap/2 + idx*(barW*2+barGap+gap) + (barW+barGap/2);
          const yi = scaleY(accArr[idx]);
          marker = `<circle cx="${xi}" cy="${yi}" r="6" fill="#111827"></circle>
                    <text x="${xi+10}" y="${yi-10}" font-size="14" fill="#111827">Payback M${idx+1}</text>`;
        }
      }

      const axis = `
        <line x1="${pad.left}" y1="${pad.top-10}" x2="${pad.left}" y2="${H-pad.bottom}" stroke="rgba(2,6,23,.15)"></line>
        <line x1="${pad.left}" y1="${yZero}" x2="${W-pad.right}" y2="${yZero}" stroke="rgba(2,6,23,.12)"></line>
        <text x="${pad.left-10}" y="${yZero+5}" font-size="14" text-anchor="end" fill="rgba(15,23,42,.55)">$0</text>
        <text x="${pad.left-10}" y="${scaleY(dataMax)+5}" font-size="14" text-anchor="end" fill="rgba(15,23,42,.55)">$${fmt(dataMax)}</text>
        ${dataMin<0 ? `<text x="${pad.left-10}" y="${scaleY(dataMin)+5}" font-size="14" text-anchor="end" fill="rgba(15,23,42,.55)">$${fmt(dataMin)}</text>` : ''}
      `;

      const legendX = W - pad.right - 155, legendY = pad.top;
      const legend = `
        <rect x="${legendX}" y="${legendY-12}" width="148" height="82" rx="12" fill="#fff" stroke="rgba(2,6,23,0.10)"></rect>
        <rect x="${legendX+12}" y="${legendY}" width="12" height="12" fill="#16a34a"></rect>
        <text x="${legendX+30}" y="${legendY+10}" font-size="14" fill="var(--text)">Ahorro</text>
        <rect x="${legendX+12}" y="${legendY+26}" width="12" height="12" fill="#e30613"></rect>
        <text x="${legendX+30}" y="${legendY+36}" font-size="14" fill="var(--text)">Cuota</text>
        <line x1="${legendX+12}" y1="${legendY+60}" x2="${legendX+24}" y2="${legendY+60}" stroke="#111827" stroke-width="2.5" opacity="0.35"></line>
        <text x="${legendX+30}" y="${legendY+62}" font-size="14" fill="var(--text)">Acum.</text>
      `;

      el.innerHTML = `<svg class="w-full h-auto" viewBox="0 0 ${W} ${H}">${axis}${bars}${polyline}${marker}${legend}</svg>`;
    }

    function renderDonut(targetId, parts, labels){
      const el=$(targetId); if(!el) return;
      const data = parts.map((p,i)=>[labels[i],p]).filter(x=>x[1]>0);
      const total = data.reduce((s,p)=>s+p[1],0);

      const W=640, H=380;
      const cx=220, cy=H/2, r=H*0.38, th=54;
      let start=0;

      const colors=['#111827','#e30613','#16a34a','#f59e0b','#0ea5e9'];

      const legendX=410, font=17, lh=30;
      const legendStartY=(H-(data.length*lh))/2 + (font/2);

      const segs = data.map((p,i)=>{
        const f = total ? p[1]/total : 0;
        const a0=start*2*Math.PI, a1=(start+f)*2*Math.PI; start+=f;
        const L=(a1-a0)>Math.PI?1:0;

        const x0=cx+r*Math.cos(a0), y0=cy+r*Math.sin(a0);
        const x1=cx+r*Math.cos(a1), y1=cy+r*Math.sin(a1);
        const x0i=cx+(r-th)*Math.cos(a0), y0i=cy+(r-th)*Math.sin(a0);
        const x1i=cx+(r-th)*Math.cos(a1), y1i=cy+(r-th)*Math.sin(a1);

        const d=`M ${x0} ${y0} A ${r} ${r} 0 ${L} 1 ${x1} ${y1} L ${x1i} ${y1i} A ${r-th} ${r-th} 0 ${L} 0 ${x0i} ${y0i} Z`;
        const pct=Math.round(f*100);
        const ly=legendStartY + i*lh;

        return `<path d="${d}" fill="${colors[i%colors.length]}" opacity="0.9"></path>
                <text x="${legendX}" y="${ly}" font-size="${font}" fill="var(--text)">${p[0]}: ${pct}%</text>`;
      }).join('');

      const centerText = total>0 ? money(total) : '—';
      const center = `
        <circle cx="${cx}" cy="${cy}" r="${r-th+1}" fill="#fff" stroke="rgba(2,6,23,0.08)"></circle>
        <text x="${cx}" y="${cy}" text-anchor="middle" dominant-baseline="middle" font-size="22" fill="var(--text)" font-weight="800">${centerText}</text>
      `;

      el.innerHTML = `<svg class="w-full h-auto" viewBox="0 0 ${W} ${H}">${segs}${center}</svg>`;
    }

    function renderBars(targetId, pairs){
      const rowsData = pairs.map(([lbl,a,b,lowerIsBetter])=>({
        lines:String(lbl).replace(' (','\n(').split('\n'),
        a: a||0, b: b||0, lowerIsBetter
      }));

      const approxChar=7;
      const labelCol=Math.max(160, Math.min(260, Math.max(...rowsData.map(r=>Math.max(...r.lines.map(s=>s.length))*approxChar))));
      const barStartX=labelCol+16;
      const barMax=520;
      const rowH=40,rowGap=16,padY=20;
      const W=barStartX+barMax+170;
      const H=padY+rowsData.length*(rowH+rowGap)+40;

      let y=padY;
      const rows = rowsData.map(r=>{
        const maxVal=Math.max(Math.abs(r.a),Math.abs(r.b),1);
        const aw=Math.round((Math.abs(r.a)/maxVal)*barMax);
        const bw=Math.round((Math.abs(r.b)/maxVal)*barMax);

        const goodB = r.lowerIsBetter ? (r.b < r.a) : (r.b > r.a);
        const colorP = goodB ? '#16a34a' : '#e30613';

        const label=`<text x="0" y="${y+14}" font-size="14" fill="var(--text)" font-weight="800">
          ${r.lines[0]}
          ${r.lines.length>1 ? `<tspan x="0" dy="1.2em" font-weight="700" fill="rgba(15,23,42,.65)">${r.lines.slice(1).join(' ')}</tspan>` : ''}
        </text>`;

        const bars=`
          <rect x="${barStartX}" y="${y}" width="${aw}" height="12" fill="rgba(17,24,39,0.18)"></rect>
          <rect x="${barStartX}" y="${y+16}" width="${bw}" height="12" fill="${colorP}"></rect>
          <text x="${barStartX+aw+10}" y="${y+10}" font-size="12" fill="rgba(15,23,42,.75)">${isFinite(r.a)?r.a.toFixed(2):'—'}</text>
          <text x="${barStartX+bw+10}" y="${y+26}" font-size="12" fill="rgba(15,23,42,.75)">${isFinite(r.b)?r.b.toFixed(2):'—'}</text>
        `;
        y += rowH + rowGap;
        return label+bars;
      }).join('');

      const legendY=H-20, legendX=barStartX;
      const legend=`
        <rect x="${legendX}" y="${legendY-14}" width="240" height="28" rx="10" fill="#fff" stroke="rgba(2,6,23,0.10)"></rect>
        <rect x="${legendX+10}" y="${legendY-6}" width="12" height="12" fill="rgba(17,24,39,0.18)"></rect>
        <text x="${legendX+28}" y="${legendY+4}" font-size="12" fill="var(--text)" font-weight="800">Actual</text>
        <rect x="${legendX+92}" y="${legendY-6}" width="12" height="12" fill="#16a34a"></rect>
        <text x="${legendX+110}" y="${legendY+4}" font-size="12" fill="var(--text)" font-weight="800">Propuesta</text>
        <rect x="${legendX+190}" y="${legendY-6}" width="12" height="12" fill="#e30613"></rect>
        <text x="${legendX+208}" y="${legendY+4}" font-size="12" fill="var(--text)" font-weight="800">Si empeora</text>
      `;

      $(targetId).innerHTML = `<svg class="w-full h-auto" viewBox="0 0 ${W} ${H}">${rows}${legend}</svg>`;
    }

    // ========= wiring =========
    function wireAll(){
      const inputs = [
        'moneda','tc','pmes','costoHora',
        'cicloA','cicloP','vidaA','vidaP','costoHerr',
        'tmuertoA','tmuertoP','setupA','setupP','scrapA','scrapP','costoScrap',
        'sistema','interfaz','runoutA','runoutP','kVidaPorUm','kScrapPorUm',
        'qtyHolder','uHolder','qtyCollet','uCollet','qtyNut','uNut','qtyPull','uPull','qtyAcc','uAcc',
        'opex','mensualidad','capexOverrideOn','capexOverride'
      ];
      inputs.forEach(id => $(id)?.addEventListener('input', ()=>{ calcCapex(); if(window.innerWidth>=1024) calcular(); }));
      ['incCiclo','incHerr','incTM','incSetup','incScrap','incMicras'].forEach(id=>$(id)?.addEventListener('change', ()=>{ applyInclusions(); calcular(); }));

      $('sistema')?.addEventListener('change', ()=>{ syncRunoutBySystem(); calcCapex(); calcular(); });

      $('btnCalcular')?.addEventListener('click', calcular);
      $('btnCalcularMobile')?.addEventListener('click', calcular);
      $('btnPrint')?.addEventListener('click', ()=>window.print());
    }

    // init
    syncRunoutBySystem();
    applyInclusions();
    calcCapex();
    wireAll();
    calcular();
  </script>

  <script src="/assets/chatbot.js"></script>
</body>
</html>
