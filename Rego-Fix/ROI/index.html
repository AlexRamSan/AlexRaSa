<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ROI Holders REGO-FIX — Calculadora modular | AlexRaSa</title>
  <meta name="description" content="Calculadora modular de ROI enfocada en holders REGO-FIX. Ahorros por tiempo/vida de herramienta/proceso. Inversión manual. Modo blanco fijo." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --rego-green: #B7C91F;
      --rego-green-2:#AAC82D;
      --rego-turq:  #58D5D3;
      --rego-blue:  #28556C;
      --rego-red:   #D31B23;
      --rego-black: #121314;
      --rego-gd:    #44474A;
      --rego-gm:    #677071;
      --rego-gl:    #E5E6E4;
      --card: #ffffff;
      --bg: #ffffff;
      --border: rgba(40,85,108,.18);
      --shadow: 0 10px 30px rgba(18,19,20,.08);
    }
    html,body{ background: var(--bg) !important; color: var(--rego-black); }
    @media (prefers-color-scheme: dark){
      html,body{ background:#fff !important; color:#121314 !important; }
    }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: 20px;
    }
    .chip{
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: .35rem .65rem;
      font-size: .8rem;
      color: var(--rego-blue);
      background: #fff;
    }
    .btn{
      border-radius: 16px;
      padding: .75rem 1rem;
      font-weight: 700;
      border: 1px solid transparent;
      transition: .15s ease;
      user-select:none;
    }
    .btn-outline{ background:#fff; border-color: var(--border); color: var(--rego-black); }
    .btn-outline:hover{ background: rgba(183,201,31,.10); }
    .btn-danger{ background: var(--rego-red); color:#fff; }
    .btn-danger:hover{ filter: brightness(.95); }
    .kpi{
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: .9rem 1rem;
      background: #fff;
    }
    .muted{ color: var(--rego-gm); }
    .label{ color: var(--rego-gd); font-weight: 700; font-size:.9rem; }
    .input{
      width:100%;
      border:1px solid var(--border);
      border-radius: 14px;
      padding: .65rem .8rem;
      outline: none;
      background:#fff;
    }
    .input:focus{ border-color: rgba(40,85,108,.45); box-shadow: 0 0 0 4px rgba(88,213,211,.18); }
    .switch{
      position:relative; width: 52px; height: 30px; border-radius: 999px;
      background: rgba(103,112,113,.25);
      border:1px solid var(--border);
      cursor:pointer;
      flex: 0 0 auto;
    }
    .switch[data-on="true"]{ background: rgba(183,201,31,.85); }
    .switch .knob{
      position:absolute; top: 3px; left: 3px;
      width: 24px; height: 24px; border-radius: 999px;
      background:#fff; box-shadow: 0 6px 16px rgba(18,19,20,.15);
      transition: .15s ease;
    }
    .switch[data-on="true"] .knob{ transform: translateX(22px); }
    .hr{ height:1px; background: rgba(40,85,108,.14); border:0; }
    .badge{
      display:inline-flex; align-items:center; gap:.35rem;
      border-radius: 999px;
      padding:.25rem .55rem;
      font-size: .78rem;
      font-weight:700;
      border:1px solid var(--border);
      background:#fff;
    }
    .badge.inv{ color: var(--rego-blue); }
    .badge.cons{ color: var(--rego-red); }
    .small{ font-size:.85rem; }
    .by{
      font-size:.78rem;
      color: var(--rego-gm);
      letter-spacing: .02em;
    }
  </style>
</head>

<body class="min-h-screen">
  <header class="max-w-6xl mx-auto px-4 pt-6 pb-4">
    <div class="card p-4 sm:p-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex items-center gap-3">
          <img src="/assets/regofixlogo.png" alt="REGO-FIX" class="h-10 w-auto" onerror="this.style.display='none'">
          <div>
            <div class="text-xl sm:text-2xl font-extrabold" style="color:var(--rego-black)">
              ROI Holders REGO-FIX
            </div>
            <div class="muted small">
              Calculadora modular · inversión manual · modo blanco fijo
            </div>
          </div>
        </div>

        <div class="flex items-center gap-2 flex-wrap justify-start sm:justify-end">
          <span class="chip">Modo blanco fijo</span>
          <span class="chip">Colores REGO-FIX</span>
          <span class="chip">Módulos + switches funcionales</span>
        </div>
      </div>

      <div class="mt-4 rounded-2xl overflow-hidden border" style="border-color:var(--border); background:linear-gradient(90deg, rgba(183,201,31,.18), rgba(88,213,211,.18), rgba(40,85,108,.10));">
        <div class="p-4 sm:p-5 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
          <div class="flex-1">
            <div class="font-extrabold" style="color:var(--rego-blue)">Enfoque: holders (sujeción) y ROI real</div>
            <div class="muted small">Precios manuales: tú defines inversión y consumibles mensuales. Ahorros por tiempo, vida y proceso.</div>
          </div>
          <div class="text-right">
            <div class="by">by alexrasa</div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-10 space-y-6">

    <!-- 1) Configuración base + Inversión -->
    <section class="card p-4 sm:p-6">
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-lg sm:text-xl font-extrabold" style="color:var(--rego-black)">1) Configuración base e inversión</h2>
          <p class="muted small mt-1">Aquí se captura lo mínimo indispensable: costo/hora, volumen y el monto de inversión (único) + consumibles mensuales.</p>
        </div>
        <span class="badge inv">Base</span>
      </div>

      <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
        <div>
          <div class="label">Costo máquina (MXN/h)</div>
          <input id="costHour" class="input" type="number" min="0" step="1" value="850">
          <div class="muted small mt-1">Incluye operador, overhead, etc.</div>
        </div>

        <div>
          <div class="label">Piezas por mes</div>
          <input id="partsMonth" class="input" type="number" min="0" step="1" value="5000">
          <div class="muted small mt-1">Para vida y ciclo.</div>
        </div>

        <div>
          <div class="label">Inversión (MXN)</div>
          <input id="invest" class="input" type="number" min="0" step="1" value="45000">
          <div class="muted small mt-1">Pago único (holders, kits, etc.).</div>
        </div>

        <div>
          <div class="label">Consumibles mensuales (MXN/mes)</div>
          <input id="consMonth" class="input" type="number" min="0" step="1" value="0">
          <div class="muted small mt-1">Si aplica (limpieza, collets, etc.).</div>
        </div>
      </div>
    </section>

    <!-- 2) Ahorros (switches) -->
    <section class="card p-4 sm:p-6">
      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
        <div>
          <h2 class="text-lg sm:text-xl font-extrabold" style="color:var(--rego-black)">2) Ahorros estimados (3 frentes)</h2>
          <p class="muted small mt-1">Activa solo lo que aplique. Cada módulo se suma a los ahorros mensuales.</p>
        </div>
        <span class="badge inv">Ahorros</span>
      </div>

      <div class="mt-4 grid grid-cols-1 lg:grid-cols-3 gap-4">

        <!-- A) Tiempo -->
        <div class="card p-4">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="font-extrabold" style="color:var(--rego-blue)">A) Ahorro por tiempo</div>
              <div class="muted small">Cambios, setups, paros</div>
            </div>
            <div class="switch" id="swTime" data-on="true" role="switch" aria-checked="true" tabindex="0">
              <div class="knob"></div>
            </div>
          </div>

          <div class="mt-3 space-y-3" id="timeBody">
            <div class="flex items-center justify-between">
              <div class="small font-bold" style="color:var(--rego-gd)">Incluir: Cambios/mes * min/cambio</div>
              <div class="switch" id="swTimeChanges" data-on="true"><div class="knob"></div></div>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <div class="label">Cambios/mes (actual)</div>
                <input id="chgAct" class="input" type="number" min="0" step="1" value="180">
              </div>
              <div>
                <div class="label">Cambios/mes (nuevo)</div>
                <input id="chgNew" class="input" type="number" min="0" step="1" value="140">
              </div>
              <div>
                <div class="label">Min/cambio (actual)</div>
                <input id="chgMinAct" class="input" type="number" min="0" step="0.1" value="6">
              </div>
              <div>
                <div class="label">Min/cambio (nuevo)</div>
                <input id="chgMinNew" class="input" type="number" min="0" step="0.1" value="4.5">
              </div>
            </div>

            <hr class="hr"/>

            <div class="flex items-center justify-between">
              <div class="small font-bold" style="color:var(--rego-gd)">Incluir: Setups/mes * min/setup</div>
              <div class="switch" id="swTimeSetups" data-on="false"><div class="knob"></div></div>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <div class="label">Setups/mes (actual)</div>
                <input id="setAct" class="input" type="number" min="0" step="1" value="20">
              </div>
              <div>
                <div class="label">Setups/mes (nuevo)</div>
                <input id="setNew" class="input" type="number" min="0" step="1" value="18">
              </div>
              <div>
                <div class="label">Min/setup (actual)</div>
                <input id="setMinAct" class="input" type="number" min="0" step="0.1" value="25">
              </div>
              <div>
                <div class="label">Min/setup (nuevo)</div>
                <input id="setMinNew" class="input" type="number" min="0" step="0.1" value="20">
              </div>
            </div>

            <hr class="hr"/>

            <div class="flex items-center justify-between">
              <div class="small font-bold" style="color:var(--rego-gd)">Incluir: Paros/mes * min/paro</div>
              <div class="switch" id="swTimeStops" data-on="false"><div class="knob"></div></div>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <div class="label">Paros/mes (actual)</div>
                <input id="stpAct" class="input" type="number" min="0" step="1" value="12">
              </div>
              <div>
                <div class="label">Paros/mes (nuevo)</div>
                <input id="stpNew" class="input" type="number" min="0" step="1" value="8">
              </div>
              <div>
                <div class="label">Min/paro (actual)</div>
                <input id="stpMinAct" class="input" type="number" min="0" step="0.1" value="18">
              </div>
              <div>
                <div class="label">Min/paro (nuevo)</div>
                <input id="stpMinNew" class="input" type="number" min="0" step="0.1" value="12">
              </div>
            </div>

            <div class="kpi mt-3">
              <div class="muted small">Ahorro por tiempo (mensual)</div>
              <div id="saveTime" class="text-xl font-extrabold">MXN 0</div>
            </div>
          </div>
        </div>

        <!-- B) Vida herramienta -->
        <div class="card p-4">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="font-extrabold" style="color:var(--rego-blue)">B) Vida de herramienta</div>
              <div class="muted small">Más ciclos por herramienta</div>
            </div>
            <div class="switch" id="swLife" data-on="true" role="switch" aria-checked="true" tabindex="0">
              <div class="knob"></div>
            </div>
          </div>

          <div class="mt-3 space-y-3" id="lifeBody">
            <div class="grid grid-cols-2 gap-2">
              <div>
                <div class="label">Ciclos por herramienta (actual)</div>
                <input id="lifeAct" class="input" type="number" min="1" step="1" value="100">
              </div>
              <div>
                <div class="label">Ciclos por herramienta (nuevo)</div>
                <input id="lifeNew" class="input" type="number" min="1" step="1" value="160">
              </div>
            </div>

            <div class="grid grid-cols-2 gap-2">
              <div>
                <div class="label">Costo por herramienta (MXN)</div>
                <input id="toolCost" class="input" type="number" min="0" step="1" value="650">
              </div>
              <div>
                <div class="label">Herramientas iguales en proceso</div>
                <input id="toolCount" class="input" type="number" min="1" step="1" value="3">
              </div>
            </div>

            <div class="kpi">
              <div class="muted small">Ahorro por vida (mensual)</div>
              <div id="saveLife" class="text-xl font-extrabold">MXN 0</div>
            </div>
          </div>
        </div>

        <!-- C) Proceso -->
        <div class="card p-4">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="font-extrabold" style="color:var(--rego-blue)">C) Mejora de proceso</div>
              <div class="muted small">Ciclo menor por sujeción robusta</div>
            </div>
            <div class="switch" id="swProc" data-on="true" role="switch" aria-checked="true" tabindex="0">
              <div class="knob"></div>
            </div>
          </div>

          <div class="mt-3 space-y-3" id="procBody">
            <div class="grid grid-cols-2 gap-2">
              <div>
                <div class="label">Ciclo actual (min/pieza)</div>
                <input id="cycAct" class="input" type="number" min="0" step="0.01" value="3.20">
              </div>
              <div>
                <div class="label">Ciclo nuevo (min/pieza)</div>
                <input id="cycNew" class="input" type="number" min="0" step="0.01" value="2.85">
              </div>
            </div>

            <div class="kpi">
              <div class="muted small">Ahorro por proceso (mensual)</div>
              <div id="saveProc" class="text-xl font-extrabold">MXN 0</div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- 3) Resultados -->
    <section class="card p-4 sm:p-6">
      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
        <div>
          <h2 class="text-lg sm:text-xl font-extrabold" style="color:var(--rego-black)">3) Resultados</h2>
          <p class="muted small mt-1">Payback, ahorro neto mensual y ROI anual.</p>
        </div>
        <div class="flex gap-2">
          <button id="btnCopySummary" class="btn btn-outline">Copiar resumen</button>
          <button id="btnResetAll" class="btn btn-danger">Reset</button>
        </div>
      </div>

      <div class="mt-4 grid grid-cols-1 lg:grid-cols-3 gap-3">
        <div class="kpi">
          <div class="muted small">Ahorro bruto mensual</div>
          <div id="grossSave" class="text-2xl font-extrabold">MXN 0</div>
          <div class="muted small">Tiempo + vida + proceso</div>
        </div>
        <div class="kpi">
          <div class="muted small">Ahorro neto mensual</div>
          <div id="netSave" class="text-2xl font-extrabold">MXN 0</div>
          <div class="muted small">Bruto − consumibles mensuales</div>
        </div>
        <div class="kpi">
          <div class="muted small">Payback (meses)</div>
          <div id="payback" class="text-2xl font-extrabold">—</div>
          <div class="muted small">Inversión / neto mensual</div>
        </div>
      </div>

      <div class="mt-3 grid grid-cols-1 lg:grid-cols-2 gap-3">
        <div class="kpi">
          <div class="muted small">ROI anual estimado</div>
          <div id="roiAnnual" class="text-2xl font-extrabold">—</div>
          <div class="muted small">((neto*12) / inversión)</div>
        </div>
        <div class="kpi">
          <div class="muted small">by</div>
          <div class="by">alexrasa</div>
        </div>
      </div>
    </section>

    <footer class="text-center pb-4">
      <div class="by">by alexrasa</div>
    </footer>

  </main>

<script>
/* ========= state ========= */
const state = {
  switches: {
    time: true,
    timeChanges: true,
    timeSetups: false,
    timeStops: false,
    life: true,
    proc: true
  }
};

const $ = (id)=>document.getElementById(id);
const clamp0 = (n)=>Math.max(0, Number(n||0));
const money = (n)=>"MXN " + Number(n||0).toLocaleString("es-MX",{maximumFractionDigits:0});

function safeJson(str, fallback){ try{ return JSON.parse(str); }catch{ return fallback; } }
function persist(){
  localStorage.setItem("rego_switches_v2", JSON.stringify(state.switches));
}
function load(){
  const sw = localStorage.getItem("rego_switches_v2");
  if(sw) state.switches = safeJson(sw, state.switches);
}

/* ========= switches ========= */
function setSwitch(el, on){ el.dataset.on = on ? "true":"false"; }
function getSwitch(el){ return el.dataset.on === "true"; }

function bindSwitch(id, key){
  const el = $(id);
  setSwitch(el, !!state.switches[key]);
  const toggle = ()=>{
    const next = !getSwitch(el);
    setSwitch(el, next);
    state.switches[key] = next;
    persist();
    renderAll();
  };
  el.addEventListener("click", toggle);
  el.addEventListener("keydown",(e)=>{
    if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggle(); }
  });
}

/* ========= calc ========= */
function calc(){
  const costHour = clamp0($("costHour").value);
  const costMin  = costHour / 60;

  const partsMonth = clamp0($("partsMonth").value);
  const invest = clamp0($("invest").value);
  const consMonth = clamp0($("consMonth").value);

  let saveTime = 0, saveLife = 0, saveProc = 0;

  // A) time
  if(state.switches.time){
    let minSaved = 0;

    if(state.switches.timeChanges){
      const a = clamp0($("chgAct").value), b = clamp0($("chgNew").value);
      const ma = clamp0($("chgMinAct").value), mb = clamp0($("chgMinNew").value);
      minSaved += Math.max(0, (a*ma) - (b*mb));
    }
    if(state.switches.timeSetups){
      const a = clamp0($("setAct").value), b = clamp0($("setNew").value);
      const ma = clamp0($("setMinAct").value), mb = clamp0($("setMinNew").value);
      minSaved += Math.max(0, (a*ma) - (b*mb));
    }
    if(state.switches.timeStops){
      const a = clamp0($("stpAct").value), b = clamp0($("stpNew").value);
      const ma = clamp0($("stpMinAct").value), mb = clamp0($("stpMinNew").value);
      minSaved += Math.max(0, (a*ma) - (b*mb));
    }

    saveTime = minSaved * costMin;
  }

  // B) life
  if(state.switches.life){
    const lifeAct = Math.max(1, clamp0($("lifeAct").value));
    const lifeNew = Math.max(1, clamp0($("lifeNew").value));
    const toolCost = clamp0($("toolCost").value);
    const toolCount = Math.max(1, clamp0($("toolCount").value));

    const toolsAct = (partsMonth / lifeAct) * toolCount;
    const toolsNew = (partsMonth / lifeNew) * toolCount;
    const spendAct = toolsAct * toolCost;
    const spendNew = toolsNew * toolCost;

    saveLife = Math.max(0, spendAct - spendNew);
  }

  // C) process
  if(state.switches.proc){
    const cycAct = clamp0($("cycAct").value);
    const cycNew = clamp0($("cycNew").value);
    const minSavedPer = Math.max(0, cycAct - cycNew);
    saveProc = (minSavedPer * partsMonth) * costMin;
  }

  const gross = saveTime + saveLife + saveProc;
  const net = Math.max(0, gross - consMonth);

  let payback = null;
  if(invest > 0 && net > 0) payback = invest / net;

  let roiAnnual = null;
  if(invest > 0) roiAnnual = (net * 12) / invest;

  return { invest, consMonth, saveTime, saveLife, saveProc, gross, net, payback, roiAnnual };
}

/* ========= render ========= */
function toggleBlock(id, on){
  const el = $(id);
  el.style.opacity = on ? "1" : ".45";
  el.style.pointerEvents = on ? "auto" : "none";
}

function renderSwitchBodies(){
  toggleBlock("timeBody", state.switches.time);
  toggleBlock("lifeBody", state.switches.life);
  toggleBlock("procBody", state.switches.proc);
}

function renderKPIs(){
  const r = calc();
  $("saveTime").textContent = money(r.saveTime);
  $("saveLife").textContent = money(r.saveLife);
  $("saveProc").textContent = money(r.saveProc);

  $("grossSave").textContent = money(r.gross);
  $("netSave").textContent = money(r.net);

  $("payback").textContent = (r.payback===null) ? "—" : (r.payback.toFixed(1) + " meses");
  $("roiAnnual").textContent = (r.roiAnnual===null) ? "—" : ((r.roiAnnual*100).toFixed(0) + "%");
}

function renderAll(){
  renderSwitchBodies();
  renderKPIs();
}

function copySummary(){
  const r = calc();
  const lines = [
    "ROI Holders REGO-FIX — Resumen",
    `Inversión: ${money(r.invest)}`,
    `Consumibles mensuales: ${money(r.consMonth)}`,
    `Ahorro tiempo (mensual): ${money(r.saveTime)}`,
    `Ahorro vida (mensual): ${money(r.saveLife)}`,
    `Ahorro proceso (mensual): ${money(r.saveProc)}`,
    `Ahorro bruto mensual: ${money(r.gross)}`,
    `Ahorro neto mensual: ${money(r.net)}`,
    `Payback: ${r.payback===null ? "—" : (r.payback.toFixed(1)+" meses")}`,
    `ROI anual: ${r.roiAnnual===null ? "—" : ((r.roiAnnual*100).toFixed(0)+"%")}`,
    "",
    "by alexrasa"
  ];
  navigator.clipboard.writeText(lines.join("\n")).then(()=>{
    alert("Resumen copiado.");
  }).catch(()=>{
    alert("No se pudo copiar.");
  });
}

function resetAll(){
  if(!confirm("¿Reset? Se restauran switches a default.")) return;
  localStorage.removeItem("rego_switches_v2");
  state.switches = {
    time: true,
    timeChanges: true,
    timeSetups: false,
    timeStops: false,
    life: true,
    proc: true
  };
  // re-sync switch UI
  ["swTime","swTimeChanges","swTimeSetups","swTimeStops","swLife","swProc"].forEach((id)=>{
    const keyMap = {
      swTime:"time",
      swTimeChanges:"timeChanges",
      swTimeSetups:"timeSetups",
      swTimeStops:"timeStops",
      swLife:"life",
      swProc:"proc"
    };
    setSwitch($(id), state.switches[keyMap[id]]);
  });
  renderAll();
}

/* ========= wiring ========= */
function bindInputs(){
  [
    "costHour","partsMonth","invest","consMonth",
    "chgAct","chgNew","chgMinAct","chgMinNew",
    "setAct","setNew","setMinAct","setMinNew",
    "stpAct","stpNew","stpMinAct","stpMinNew",
    "lifeAct","lifeNew","toolCost","toolCount",
    "cycAct","cycNew"
  ].forEach(id=>{
    $(id).addEventListener("input", renderAll);
    $(id).addEventListener("change", renderAll);
  });

  $("btnCopySummary").addEventListener("click", copySummary);
  $("btnResetAll").addEventListener("click", resetAll);
}

load();
bindSwitch("swTime","time");
bindSwitch("swTimeChanges","timeChanges");
bindSwitch("swTimeSetups","timeSetups");
bindSwitch("swTimeStops","timeStops");
bindSwitch("swLife","life");
bindSwitch("swProc","proc");

bindInputs();
renderAll();
</script>
</body>
</html>
