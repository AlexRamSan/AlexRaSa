<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SolidCAM ROI — Calculadora de Costo-Beneficio</title>
<meta name="description" content="Calculadora ROI para SolidCAM: insourcing de programación, reducción de ciclo con iMachining y ahorro en herramienta. Calcula ahorros, ROI, payback y flujo." />
<meta name="theme-color" content="#0F172A" />
<meta name="robots" content="index,follow" />
<link rel="canonical" href="https://alexrasa.store/proyectos/calculadoras/solidcam/" />
<link rel="manifest" href="/proyectos/calculadoras/solidcam/solidcam.webmanifest">
<meta name="color-scheme" content="dark">

<!-- Íconos -->
<link rel="icon" type="image/png" sizes="32x32" href="/proyectos/calculadoras/solidcam/icons/icon-256.png" />
<link rel="apple-touch-icon" href="/proyectos/calculadoras/solidcam/icons/icon-192.png" />

<!-- Preload hero -->
<link rel="preload" as="image" href="/assets/hero-industrial.png">

<!-- Tailwind CDN para prototipo (para prod usar build local) -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  :root{
    color-scheme: dark;
    --bg:#071027; --card:#0f172a; --text:#e6eef8;
    --accent:#60a5fa; --accent-2:#6366F1; --good:#22C55E; --bad:#EF4444;
  }
  html,body{background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  a{color:var(--accent)}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); border-radius:14px}
  input,select,textarea{background:rgba(255,255,255,0.02); color:var(--text); border:1px solid rgba(255,255,255,0.06); padding:.55rem .65rem; border-radius:.6rem}
  input:focus,select:focus{box-shadow:0 0 0 6px rgba(99,102,241,0.10); outline:none}
  .hero-bg{position:relative; background-size:cover; background-position:center; min-height:320px; overflow:hidden}
  .hero-bg::before{content:"";position:absolute;inset:0;background:linear-gradient(180deg, rgba(2,6,23,0.25), rgba(2,6,23,0.65));z-index:1}
  .hero-content{position:relative;z-index:2}
  .stat{border:1px solid rgba(255,255,255,0.06); border-radius:12px; padding:12px}
  .badge{display:inline-block;padding:.25rem .55rem;border-radius:999px;font-weight:700;font-size:11px;min-width:56px;text-align:center;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.03)}
  table{border-collapse:separate;border-spacing:0 8px}
  thead th{font-weight:600;color:#cbd5e1}
  tbody tr{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04)}
  .viz-xl{ min-height:520px }
</style>
</head>
<body class="antialiased">

<header class="sticky top-0 z-40 backdrop-blur" style="background:rgba(2,6,23,0.55);border-bottom:1px solid rgba(255,255,255,0.04)">
  <div class="max-w-6xl mx-auto px-4">
    <div class="h-16 flex items-center justify-between gap-3">
      <a href="/" class="flex items-center gap-2 shrink-0" aria-label="Inicio">
        <img src="/assets/logo.png" alt="AlexRaSa" class="h-9 w-auto" />
        <span class="hidden sm:inline text-base font-semibold tracking-tight">AlexRaSa<span style="color:var(--accent)">.store</span></span>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="/SolidCAM/" class="hover:text-sky-400">Soluciones</a>
        <a href="/#recursos" class="hover:text-sky-400">Recursos</a>
        <a href="/#contacto" class="hover:text-sky-400">Contacto</a>
      </nav>
    </div>
  </div>
</header>

<section class="hero-bg" style="background-image:url('/assets/hero-industrial.png')">
  <div class="hero-content max-w-6xl mx-auto px-4 py-10 md:py-16">
    <h1 class="text-3xl md:text-5xl font-extrabold">SolidCAM ROI — <span style="color:var(--accent)">Calculadora</span></h1>
    <p class="mt-3 max-w-3xl text-slate-200">Insourcing de programación + iMachining opcional. Calcula ahorros mensuales, ROI, payback y flujo con CAPEX o esquema mixto 30/70.</p>
  </div>
</section>

<main class="max-w-6xl mx-auto px-4 pt-8 pb-24 grid gap-5 lg:grid-cols-12">
  <!-- FORM -->
  <section class="card p-5 lg:col-span-4 lg:sticky lg:top-20 max-h-[calc(100vh-6rem)] overflow-auto">
    <h2 class="text-lg font-semibold">Entradas</h2>
    <div class="mt-4 space-y-6">
      <!-- A) Insourcing programación -->
      <fieldset class="space-y-3">
        <legend class="text-sm font-semibold">A) Insourcing de programación</legend>
        <div class="grid grid-cols-2 gap-3">
          <label class="text-sm">NC por mes
            <input id="ncMes" type="number" value="200" min="0">
          </label>
          <label class="text-sm">Fee por programa externo (USD)
            <input id="feeProgExt" type="number" value="90" min="0">
          </label>
          <label class="text-sm">Cambios por NC
            <input id="cambiosPorNC" type="number" value="0.4" min="0" step="0.01">
          </label>
          <label class="text-sm">Fee por cambio externo (USD)
            <input id="feeCambioExt" type="number" value="35" min="0">
          </label>
          <label class="text-sm">Espera por cambio (h)
            <input id="horasEsperaCambio" type="number" value="3" min="0" step="0.1">
          </label>
          <label class="text-sm">Costo hora máquina (USD)
            <input id="costoHoraMaquina" type="number" value="70" min="0">
          </label>
          <label class="text-sm">Costo hora programador interno (USD)
            <input id="costoHoraProg" type="number" value="20" min="0">
          </label>
          <label class="text-sm">Min/NC con SolidCAM
            <input id="minProgSC" type="number" value="20" min="0">
          </label>
          <label class="text-sm">Min por ajuste con SolidCAM
            <input id="minAjusteSC" type="number" value="10" min="0">
          </label>
        </div>
      </fieldset>

      <!-- B) iMachining opcional -->
      <fieldset class="space-y-3">
        <label class="flex items-center gap-2 text-sm">
          <input id="incIM" type="checkbox" class="h-4 w-4"> Incluir beneficios de iMachining
        </label>
        <div class="grid grid-cols-2 gap-3">
          <label class="text-sm">Horas de máquina impactadas/mes
            <input id="horasImpactoMes" type="number" value="120" min="0">
          </label>
          <label class="text-sm">% reducción de ciclo
            <input id="pctReduccionCiclo" type="number" value="30" min="0" max="100">
          </label>
          <label class="text-sm">Gasto herramienta actual/mes (USD)
            <input id="gastoHerrActual" type="number" value="2500" min="0">
          </label>
          <label class="text-sm">% reducción gasto herramienta
            <input id="pctReduccionHerr" type="number" value="20" min="0" max="100">
          </label>
        </div>
        <p class="text-xs text-slate-400">Si no quieres considerar iMachining, desmarca la casilla. Los resultados se mantienen conservadores.</p>
      </fieldset>

      <!-- Modelo financiero -->
      <fieldset class="space-y-3">
        <legend class="text-sm font-semibold">Finanzas</legend>
        <div class="grid grid-cols-2 gap-3">
          <label class="text-sm">CAPEX (USD)
            <input id="capex" type="number" value="22690" min="0">
          </label>
          <label class="text-sm">Mensualidad (USD) — si aplica
            <input id="mensualidad" type="number" value="0" min="0">
          </label>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <label class="text-sm">Plan 30% anticipo
            <input id="planAnticipo" type="number" value="30" min="0" max="100">
          </label>
          <label class="text-sm">Meses para 70% restante
            <input id="planMeses" type="number" value="3" min="1">
          </label>
        </div>
      </fieldset>

      <button id="btnCalc" class="w-full py-2.5 rounded-md font-semibold" style="background:var(--accent-2);color:white">Calcular</button>
    </div>
  </section>

  <!-- OUTPUT -->
  <section class="lg:col-span-8 grid gap-5">
    <!-- KPIs -->
    <div class="card p-4">
      <h3 class="text-sm font-semibold mb-3">KPIs</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <div class="stat">
          <div class="text-xs text-slate-300">ROI anual</div>
          <div id="kpiROI" class="text-xl font-bold">0%</div>
        </div>
        <div class="stat">
          <div class="text-xs text-slate-300">Payback (meses)</div>
          <div id="kpiPayback" class="text-xl font-bold">—</div>
        </div>
        <div class="stat">
          <div class="text-xs text-slate-300">Neto mensual (ahorro − cuota)</div>
          <div id="kpiNeto" class="text-xl font-bold">$0</div>
        </div>
        <div class="stat">
          <div class="text-xs text-slate-300">Ahorro dominante</div>
          <div id="kpiTop" class="text-sm"><span class="badge">—</span></div>
        </div>
      </div>
      <div class="mt-3 text-xs text-slate-300" id="kpiPlan"></div>
    </div>

    <!-- Tabla -->
    <div class="card p-5">
      <h2 class="text-lg font-semibold">Desglose de ahorros mensuales</h2>
      <div class="mt-3 overflow-auto -mx-2 sm:mx-0">
        <table class="w-full text-sm">
          <thead>
            <tr>
              <th class="text-left px-2 py-1">Concepto</th>
              <th class="text-right px-2 py-1">Ahorro mensual (USD)</th>
            </tr>
          </thead>
          <tbody id="tbodyAhorros"></tbody>
          <tfoot>
            <tr>
              <td class="px-2 py-2 font-semibold">Total</td>
              <td id="tdTotal" class="px-2 py-2 text-right font-semibold"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <!-- Gráficos verticales (uno debajo del otro) -->
    <div class="card p-4">
      <h3 class="text-sm font-semibold">Distribución de ahorros</h3>
      <div id="vizDonut" class="mt-3 viz-xl"></div>
    </div>

    <div class="card p-4">
      <h3 class="text-sm font-semibold">Flujo mensual y payback</h3>
      <div id="vizCash" class="mt-3 viz-xl"></div>
    </div>
  </section>
</main>

<footer class="py-8 text-center text-sm text-slate-400">© 2025 AlexRaSa — SolidCAM ROI</footer>

<script>
  // Utils
  const fmt = (n, d=2) => Number(n||0).toLocaleString('en-US',{minimumFractionDigits:d,maximumFractionDigits:d});

  function calcInsourcing(){
    const ncMes = +nc('ncMes'), feeProgExt=+nc('feeProgExt'), cambiosPorNC=+nc('cambiosPorNC'),
          feeCambioExt=+nc('feeCambioExt'), horasEspera=+nc('horasEsperaCambio'),
          rateMaq=+nc('costoHoraMaquina'), rateProg=+nc('costoHoraProg'),
          minProgSC=+nc('minProgSC'), minAjSC=+nc('minAjusteSC');

    // Gasto actual
    const gastoProgExt = ncMes * feeProgExt;
    const gastoCambiosExt = ncMes * cambiosPorNC * feeCambioExt;
    const paroEspera = ncMes * cambiosPorNC * horasEspera * rateMaq;
    const costoActual = gastoProgExt + gastoCambiosExt + paroEspera;

    // Costo interno
    const costoProgInt = ncMes * (minProgSC/60) * rateProg;
    const costoAjInt   = ncMes * cambiosPorNC * (minAjSC/60) * rateProg;
    const costoInterno = costoProgInt + costoAjInt;

    return { ahorro: Math.max(0, costoActual - costoInterno), detalle:{
      "Insourcing programación": Math.max(0, costoActual - costoInterno)
    }};
  }

  function calcIMach(){
    if(!document.getElementById('incIM').checked) return { ahorro:0, detalle:{} };
    const horasImpacto=+nc('horasImpactoMes'), pctCiclo=+nc('pctReduccionCiclo'),
          gastoHerr=+nc('gastoHerrActual'), pctHerr=+nc('pctReduccionHerr'),
          rateMaq=+nc('costoHoraMaquina');

    const ahorroCiclo = (horasImpacto * (pctCiclo/100)) * rateMaq;
    const ahorroHerr  = gastoHerr * (pctHerr/100);
    const total = Math.max(0, ahorroCiclo) + Math.max(0, ahorroHerr);
    return { ahorro: total, detalle:{
      "Reducción de ciclo (iMachining)": Math.max(0, ahorroCiclo),
      "Ahorro en herramienta": Math.max(0, ahorroHerr)
    }};
  }

  function calcular(){
    const A = calcInsourcing();
    const B = calcIMach();
    const parts = [
      ["Insourcing programación", A.detalle["Insourcing programación"]||0],
      ["Reducción de ciclo (iMachining)", B.detalle["Reducción de ciclo (iMachining)"]||0],
      ["Ahorro en herramienta", B.detalle["Ahorro en herramienta"]||0]
    ];
    const total = parts.reduce((s,p)=>s+p[1],0);

    // KPIs
    const capex=+nc('capex'), cuota=+nc('mensualidad');
    const roiAnual = capex>0 ? ((total*12)/capex)*100 : 0;
    const neto = total - cuota;
    const idxPayback = capex>0 && neto>0 ? Math.ceil(capex/neto) : -1;

    // Tabla
    const body = document.getElementById('tbodyAhorros');
    body.innerHTML = parts
      .filter(p=>p[1]>0.0001)
      .map(([k,v])=>`<tr><td class="px-2 py-2">${k}</td><td class="px-2 py-2 text-right font-mono">$${fmt(v)}</td></tr>`)
      .join('') || `<tr><td colspan="2" class="px-2 py-3 text-center text-slate-400">Sin ahorros activos</td></tr>`;
    document.getElementById('tdTotal').textContent = `$${fmt(total)}`;

    // KPIs render
    document.getElementById('kpiROI').textContent = `${fmt(roiAnual)}%`;
    document.getElementById('kpiPayback').textContent = idxPayback>0 ? idxPayback : '—';
    const kN = document.getElementById('kpiNeto');
    kN.textContent = `$${fmt(neto)}`;
    kN.style.color = neto>=0 ? 'var(--good)' : 'var(--bad)';
    const top = parts.slice().sort((a,b)=>b[1]-a[1])[0];
    document.getElementById('kpiTop').innerHTML = top && top[1]>0 ? `<span class="badge">${top[0]}</span>` : '<span class="badge">—</span>';

    // Plan 30/70
    const pctAnt = Math.min(100, Math.max(0, +nc('planAnticipo')));
    const mesesPlan = Math.max(1, +nc('planMeses')|0);
    const anticipo = capex*(pctAnt/100);
    const restante = capex - anticipo;
    const pagoMensualPlan = restante/mesesPlan;
    const netMesPlan = (m)=> (total - (m<=mesesPlan ? pagoMensualPlan : 0));
    const netM1Anticipo = total - anticipo;
    document.getElementById('kpiPlan').textContent =
      `Plan ${pctAnt}% + ${mesesPlan} meses: anticipo $${fmt(anticipo,0)}, pagos $${fmt(pagoMensualPlan,0)}. ` +
      `Mes 1 (con anticipo): $${fmt(netM1Anticipo,0)}; Meses 2–${mesesPlan+1}: $${fmt(netMesPlan(2),0)}; Desde M${mesesPlan+2}: $${fmt(total,0)}.`;

    // Gráficos
    renderDonut('vizDonut', parts);
    renderCashflow('vizCash', { ahorroMes: total, cuota, capex });
  }

  // Donut SVG
  function renderDonut(targetId, parts){
    const el = document.getElementById(targetId); if(!el) return;
    const data = parts.filter(p=>p[1]>0);
    const total = data.reduce((s,p)=>s+p[1],0);
    const W = Math.max(el.clientWidth||980,980), H = Math.max(el.clientHeight||520,520);
    const cx=Math.round(W*0.33), cy=Math.round(H*0.52), r=Math.round(Math.min(W,H)*0.28), th=Math.round(r*0.34);
    let start=0; const colors=['#6366F1','#16A34A','#F59E0B'];
    const segs = data.map((p,i)=>{
      const v=p[1], frac = total>0 ? v/total : 0;
      const a0=start*2*Math.PI, a1=(start+frac)*2*Math.PI; start+=frac;
      const large=(a1-a0)>Math.PI?1:0;
      const x0=cx+r*Math.cos(a0), y0=cy+r*Math.sin(a0);
      const x1=cx+r*Math.cos(a1), y1=cy+r*Math.sin(a1);
      const x0i=cx+(r-th)*Math.cos(a0), y0i=cy+(r-th)*Math.sin(a0);
      const x1i=cx+(r-th)*Math.cos(a1), y1i=cy+(r-th)*Math.sin(a1);
      const d=`M ${x0} ${y0} A ${r} ${r} 0 ${large} 1 ${x1} ${y1} L ${x1i} ${y1i} A ${r-th} ${r-th} 0 ${large} 0 ${x0i} ${y0i} Z`;
      const pct = total>0 ? Math.round(frac*100) : 0;
      const lx = Math.round(W*0.62), ly = 40 + 28*i;
      return `<path d="${d}" fill="${colors[i%colors.length]}" opacity="0.95"></path>
              <text x="${lx}" y="${ly}" font-size="16" fill="var(--text)">${p[0]}: ${pct}%</text>`;
    }).join('');
    const center = `<circle cx="${cx}" cy="${cy}" r="${r-th+14}" fill="rgba(255,255,255,0.04)"></circle>
                    <text x="${cx}" y="${cy}" text-anchor="middle" dominant-baseline="middle" font-size="22" fill="var(--text)">${total>0?('$'+total.toLocaleString()):'—'}</text>`;
    el.innerHTML = `<svg class="w-full h-auto" viewBox="0 0 ${W} ${H}" role="img" aria-label="Distribución de ahorros">${segs}${center}</svg>`;
  }

  // Cashflow SVG
  function renderCashflow(targetId, {ahorroMes, cuota, capex}){
    const el = document.getElementById(targetId); if(!el) return;
    const meses = Array.from({length:12}, (_,i)=>`M${i+1}`);
    const H = Math.max(el.clientHeight || 520, 520);
    const pad=36, barW=28, gap=18, cols=meses.length;
    const minW = pad*2 + cols*(barW*2 + gap) + 160;
    const W = Math.max(el.clientWidth || minW, minW);
    const neto = (ahorroMes||0) - (cuota||0);
    let acc=0; const accArr = meses.map(()=>{ acc += neto; return acc; });
    const maxY = Math.max(ahorroMes||0, cuota||0, ...accArr.map(v=>Math.abs(v)), capex||0, 1);
    const scale = v => Math.round((v/maxY) * (H - pad*2));

    let x = pad + 12;
    const bars = meses.map((m,i)=>{
      const yA = H - pad - scale(ahorroMes);
      const yM = H - pad - scale(cuota);
      const hA = scale(ahorroMes);
      const hM = scale(cuota);
      const xa = x, xm = x + barW + 8;
      const labelY = H - 10;
      const txt = `<text x="${x}" y="${labelY}" font-size="14" fill="var(--text)">${m}</text>`;
      const rects = `<rect x="${xa}" y="${yA}" width="${barW}" height="${hA}" fill="#22C55E"></rect>
                     <rect x="${xm}" y="${yM}" width="${barW}" height="${hM}" fill="#EF4444"></rect>`;
      x += (barW*2 + gap);
      return rects + txt;
    }).join('');

    const linePts = accArr.map((v,i)=>{
      const xi = pad + 12 + i*(barW*2 + gap) + barW;
      const yi = H - pad - scale(Math.max(0,v));
      return `${xi},${yi}`;
    }).join(' ');

    let marker = '';
    if ((capex||0) > 0){
      const idx = accArr.findIndex(v => v >= capex);
      if (idx !== -1){
        const mx = pad + 12 + idx*(barW*2 + gap) + barW;
        const my = H - pad - scale(Math.max(0, accArr[idx]));
        marker = `<circle cx="${mx}" cy="${my}" r="6" fill="#A78BFA"></circle>
                  <text x="${mx+10}" y="${my-10}" font-size="14" fill="#A78BFA">Payback M${idx+1}</text>`;
      }
    }
    const yCapex = H - pad - scale(capex||0);
    const capexLine = capex>0 ? `<line x1="${pad}" y1="${yCapex}" x2="${W-pad}" y2="${yCapex}" stroke="#60A5FA" stroke-dasharray="6 6"></line>
                                 <text x="${pad+10}" y="${yCapex-10}" font-size="14" fill="#60A5FA">CAPEX $${(capex||0).toLocaleString()}</text>` : '';
    const axis = `<line x1="${pad-10}" y1="${pad-6}" x2="${pad-10}" y2="${H-pad}" stroke="rgba(255,255,255,0.2)"></line>
                  <text x="${pad-14}" y="${H-pad+8}" font-size="14" text-anchor="end" fill="rgba(255,255,255,0.65)">$0</text>`;
    const polyline = `<polyline points="${linePts}" fill="none" stroke="#A78BFA" stroke-width="3"></polyline>`;

    el.innerHTML = `<svg class="w-full h-auto" viewBox="0 0 ${W} ${H}" role="img" aria-label="Flujo mensual y payback">
      ${axis}${capexLine}${bars}${polyline}${marker}
    </svg>`;
  }

  // helpers
  const nc = (id)=>document.getElementById(id).value;

  // events
  document.getElementById('btnCalc').addEventListener('click', calcular);
  document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input', calcular));
  document.getElementById('incIM').addEventListener('change', calcular);

  // init
  calcular();

  // SW
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/proyectos/calculadoras/solidcam/sw-solidcam.js', { scope: '/proyectos/calculadoras/solidcam/' })
      .catch(console.error);
  }
</script>
</body>
</html>
