<script>
  // Si llega con access_token en el hash, vuelve al admin
  if (location.hash.includes('access_token=')) location.href = '/admin/#/collections/posts/new';

  if (window.netlifyIdentity) {
    netlifyIdentity.init({
      APIUrl: 'https://alexrasa.netlify.app/.netlify/identity'
    });

    // Si ya hay sesión, ve directo a "Nuevo post"
    netlifyIdentity.on('init', (user) => {
      if (user) location.href = '/admin/#/collections/posts/new';
    });

    // Al iniciar sesión, manda a "Nuevo post"
    netlifyIdentity.on('login', () => {
      location.href = '/admin/#/collections/posts/new';
    });

    // Al cerrar sesión, regresa a la home
    netlifyIdentity.on('logout', () => {
      location.href = '/';
    });
  }
</script>
