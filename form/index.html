<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro — Evento | AlexRaSa</title>
  <meta name="description" content="Registra el interés de tu empresa en soluciones de manufactura: SolidCAM, Lantek, Logopress, Artec 3D y 3D Systems." />
  <meta name="theme-color" content="#0F172A" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            base: { 900: '#0F172A', 800: '#1E293B' }
          }
        }
      }
    };
  </script>

  <style>
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(400px) rotate(720deg); opacity: 0; }
    }
  </style>

  <!-- Google tag -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GDQ8NN6T6Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GDQ8NN6T6Q');
  </script>
</head>
<body class="bg-base-900 text-gray-100 antialiased">

  <!-- ===== HERO HEADER ===== -->
  <header class="relative">
    <div class="absolute inset-0 -z-10">
      <div class="absolute inset-0 bg-[url('/assets/hero-industrial.png')] bg-cover bg-center opacity-50"></div>
      <div class="absolute inset-0 bg-base-900/75"></div>
    </div>

    <!-- Barra superior -->
    <div class="bg-black/40 backdrop-blur-sm border-b border-white/10">
      <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
        <a href="/" class="flex items-center gap-2 text-white" aria-label="Inicio">
          <img src="/assets/logo.png" class="h-9 w-auto" alt="AlexRaSa" />
          <span class="hidden sm:inline text-base font-semibold tracking-tight">
            AlexRaSa<span class="text-sky-400">.store</span>
          </span>
        </a>

        <!-- Semáforo de sincronización -->
        <button
          id="cloudStatus"
          type="button"
          class="text-xs inline-flex items-center gap-2 text-gray-200 hover:text-white transition cursor-pointer select-none"
          title="Probar conexión con Google Sheets (clic)"
        >
          <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
          Sincronización pendiente
        </button>
      </div>
    </div>

    <!-- Hero compacto -->
    <section class="max-w-6xl mx-auto px-4 py-8 md:py-10 text-white">
      <p class="text-xs md:text-[13px] uppercase tracking-[0.18em] text-sky-300/80 mb-1">
        Registro de interés
      </p>
      <h1 class="text-3xl md:text-4xl font-extrabold leading-tight max-w-2xl">
        Registro para <span class="text-sky-300">evento y diagnóstico</span> de manufactura
      </h1>
      <p class="mt-2 text-white/85 text-sm md:text-base max-w-2xl">
        Déjame tus datos para ayudarte a identificar oportunidades en SolidCAM, Lantek, Logopress,
        Artec 3D o 3D Systems. Solo se tarda un par de minutos.
      </p>
    </section>
  </header>

  <!-- ===== FORMULARIO ===== -->
  <main class="max-w-4xl mx-auto px-4 pb-14">
    <section class="bg-white/5 rounded-2xl border border-white/10 shadow-[0_18px_45px_rgba(0,0,0,0.55)] backdrop-blur-md p-5 md:p-7">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-5">
        <div>
          <h2 class="text-lg md:text-xl font-semibold text-white">Datos de la empresa</h2>
          <p class="text-xs md:text-sm text-gray-300 mt-1">
            Campos marcados con * son obligatorios. Usa el teléfono que más revisas (WhatsApp recomendado).
          </p>
        </div>
        <div class="flex flex-wrap gap-2 text-[11px] md:text-xs text-gray-300">
          <span class="px-2 py-1 rounded-full border border-sky-500/40 bg-sky-500/10">
            SolidCAM &amp; iMachining
          </span>
          <span class="px-2 py-1 rounded-full border border-emerald-500/40 bg-emerald-500/10">
            Diagnóstico sin costo
          </span>
        </div>
      </div>

      <form id="leadForm" class="grid gap-4" novalidate>
        <div>
          <label class="block text-sm font-medium text-gray-200">Empresa *</label>
          <input
            id="empresa"
            name="empresa"
            required
            class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
            placeholder="Nombre de la empresa"
          >
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-200">Contacto *</label>
            <input
              id="contacto"
              name="contacto"
              required
              class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
              placeholder="Nombre completo"
            >
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-200">Puesto *</label>
            <input
              id="puesto"
              name="puesto"
              required
              class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
              placeholder="Puesto o rol"
            >
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-200">Teléfono *</label>
            <input
              id="telefono"
              name="telefono"
              required
              class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
              placeholder="WhatsApp / fijo"
            >
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-200">Email *</label>
            <input
              id="email"
              name="email"
              type="email"
              required
              class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
              placeholder="correo@empresa.com"
            >
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-200">Ciudad *</label>
            <input
              id="ciudad"
              name="ciudad"
              required
              class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
              placeholder="Querétaro"
            >
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-200">Estado *</label>
            <input
              id="estado"
              name="estado"
              required
              class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
              placeholder="Qro."
            >
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-200">Industria *</label>
          <input
            id="industria"
            name="industria"
            required
            class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
            placeholder="Automotriz, aeroespacial…"
          >
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-200">Área de interés *</label>
          <select
            id="interes"
            name="interes"
            required
            class="mt-1 w-full rounded-md border border-white/20 bg-white px-3 py-2 text-sm text-gray-900 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
          >
            <option value="">— Selecciona —</option>
            <option>SolidCAM & iMachining</option>
            <option>Lantek — Corte & Nesting</option>
            <option>Logopress — Troqueles</option>
            <option>Artec 3D — Escáneres</option>
            <option>3D Systems — Impresión 3D</option>
            <option>Otro</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-200">Área de interés y comentarios *</label>
          <textarea
            id="notas"
            name="notas"
            required
            rows="4"
            class="mt-1 w-full rounded-md border border-white/20 bg-white/5 px-3 py-2 text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-sky-500 focus:border-sky-500"
            placeholder="Área de interés, oportunidades detectadas, máquinas, retos actuales…"
          ></textarea>
        </div>

        <div class="flex flex-col md:flex-row md:items-center justify-between gap-3 text-[11px] text-gray-400">
          <p>Al enviar tus datos, aceptas que te contacte para revisar oportunidades en tu proceso.</p>
          <p class="italic">Nada de spam. Solo temas de manufactura que aporten valor.</p>
        </div>

        <div class="mt-2 flex items-center gap-3">
          <button
            type="submit"
            id="submitBtn"
            class="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-md bg-sky-600 text-white text-sm font-medium hover:bg-sky-700 disabled:opacity-60 disabled:cursor-not-allowed transition"
          >
            <span id="submitLabel">Guardar información</span>
          </button>
        </div>
      </form>
    </section>
  </main>

  <!-- ===== MODAL ===== -->
  <div
    id="thankModal"
    class="fixed inset-0 z-50 hidden bg-black/70 backdrop-blur-sm flex items-center justify-center"
  >
    <div class="bg-white rounded-2xl shadow-2xl p-8 text-center text-gray-800 max-w-sm mx-4 relative overflow-hidden">
      <div id="confettiContainer" class="absolute inset-0 pointer-events-none"></div>
      <div class="text-5xl mb-2">✅</div>
      <h2 class="text-2xl font-bold text-emerald-600">¡Muchas gracias!</h2>
      <p class="mt-2 text-sm text-gray-700">
        Tu información ha sido registrada correctamente.<br>
        En breve revisaré tus datos y te contactaré para el siguiente paso.
      </p>
      <button
        id="closeModal"
        class="mt-5 px-4 py-2 bg-sky-600 text-white text-sm rounded-md hover:bg-sky-700"
      >
        Aceptar
      </button>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="bg-black/40 border-t border-white/10 py-5 mt-4 text-center text-[11px] text-gray-400">
    © 2025 <strong>AlexRaSa</strong> — Ingeniería y soluciones para manufactura<br>
    <a href="https://alexrasa.store" class="text-sky-400 hover:underline">alexrasa.store</a>
  </footer>

  <script>
    const WEB_APP_URL = '/api/sendLead';

    const $ = s => document.querySelector(s);
    const form = $('#leadForm');
    const modal = $('#thankModal');
    const closeModal = $('#closeModal');
    const confettiContainer = $('#confettiContainer');
    const statusEl = $('#cloudStatus');
    const submitBtn = $('#submitBtn');
    const submitLabel = $('#submitLabel');

    function setStatus(state){
      if(!statusEl) return;
      if(state==='syncing'){
        statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-blue-400"></span> Sincronizando...';
      }else if(state==='ok'){
        statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-emerald-500"></span> Sincronizado';
      }else{
        statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-yellow-400"></span> Sincronización pendiente';
      }
    }

    function launchConfetti() {
      for (let i = 0; i < 40; i++) {
        const piece = document.createElement('div');
        piece.className = 'absolute w-2 h-2';
        piece.style.background = `hsl(${Math.random() * 360},100%,60%)`;
        piece.style.left = Math.random() * 100 + '%';
        piece.style.top = '-10px';
        piece.style.opacity = 0.9;
        piece.style.animation = 'confettiFall 2s linear forwards';
        piece.style.animationDelay = (Math.random() * 1) + 's';
        confettiContainer.appendChild(piece);
        setTimeout(() => piece.remove(), 2500);
      }
    }

    async function postJSON(url, payload){
      const r = await fetch(url, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await r.json().catch(()=>({}));
      return { ok: r.ok && (data.ok !== false), data };
    }

    // Probar conexión con clic en semáforo
    let testing = false;
    statusEl?.addEventListener('click', async () => {
      if (testing) return;
      testing = true;
      setStatus('syncing');

      const testLead = {
        id: crypto.randomUUID(),
        fecha: new Date().toLocaleDateString('es-MX'),
        createdAt: new Date().toISOString(),
        empresa: 'TEST',
        contacto: 'Prueba de conexión',
        puesto: '—',
        telefono: '—',
        email: 'test@alexrasa.store',
        ciudad: '—',
        estado: '—',
        industria: '—',
        interes: 'Otro',
        maquinas: '',
        origen: 'Prueba',
        nextDate: '',
        notas: 'Registro de prueba desde el botón de estado'
      };

      try {
        const { ok } = await postJSON(WEB_APP_URL, testLead);
        setStatus(ok ? 'ok' : 'pending');
        alert(ok
          ? '✅ Conexión OK. Revisa tu Google Sheet: verás un TEST.'
          : '⚠️ No se pudo conectar. Revisa tu deployment en Vercel y el Apps Script.'
        );
      } catch {
        setStatus('pending');
        alert('⚠️ Error de red al probar conexión.');
      } finally {
        testing = false;
      }
    });

    // Envío del formulario
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!form.checkValidity()) { form.reportValidity(); return; }

      const f = Object.fromEntries(new FormData(form).entries());
      const lead = {
        id: crypto.randomUUID(),
        fecha: new Date().toLocaleDateString('es-MX'),
        createdAt: new Date().toISOString(),
        empresa: f.empresa,
        contacto: f.contacto,
        puesto: f.puesto,
        telefono: f.telefono,
        email: f.email,
        ciudad: f.ciudad,
        estado: f.estado,
        industria: f.industria,
        interes: f.interes,
        maquinas: '',
        origen: 'Evento',
        nextDate: '',
        notas: f.notas || ''
      };

      setStatus('syncing');
      submitBtn.disabled = true;
      submitLabel.textContent = 'Enviando...';

      try{
        const { ok } = await postJSON(WEB_APP_URL, lead);
        setStatus(ok ? 'ok' : 'pending');
      }catch{
        setStatus('pending');
      }

      form.reset();
      submitBtn.disabled = false;
      submitLabel.textContent = 'Guardar información';

      modal.classList.remove('hidden');
      launchConfetti();
    });

    closeModal.addEventListener('click', () => modal.classList.add('hidden'));
    setStatus('pending');
  </script>
  <script src="/assets/js/cnc-express-popup.js" defer></script>
</body>
</html>
