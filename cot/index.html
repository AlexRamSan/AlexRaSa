<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Configurador de Módulos SolidCAM — Máquinas, Procesos y Prioridades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            base: { 900: '#020617', 800: '#0F172A', 700: '#1E293B' },
            accent: { 500: '#22c55e', 400: '#4ade80' },
          }
        }
      }
    };
  </script>
</head>
<body class="bg-base-900 text-slate-100 min-h-screen">
  <div class="max-w-6xl mx-auto px-4 py-8 space-y-8">
    <!-- HEADER -->
    <header class="border-b border-slate-700 pb-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <div>
        <h1 class="text-2xl md:text-3xl font-semibold">
          Configurador de módulos SolidCAM
        </h1>
        <p class="text-slate-300 text-sm md:text-base">
          Define máquinas, procesos y prioridades. El sistema recomienda módulos, posts y servicios, con resumen de precios por esquema de licencia.
        </p>
      </div>
      <div class="text-xs md:text-sm text-slate-400">
        Lógica basada en: tipo de máquina → tipo de proceso → prioridad del cliente.
      </div>
    </header>

    <!-- FORMULARIO: MÁQUINAS -->
    <section class="bg-base-800/80 border border-slate-700 rounded-2xl p-4 md:p-6 space-y-4">
      <h2 class="text-lg font-semibold flex items-center gap-2">
        1. Máquinas en planta
        <span class="text-xs font-normal text-slate-400">
          (define la base: Milling / Turning / Mill-Turn / Wire)
        </span>
      </h2>
      <div class="grid md:grid-cols-2 gap-4 text-sm">
        <div class="space-y-2">
          <h3 class="text-slate-200 font-medium text-sm">Centros de maquinado</h3>
          <div class="flex items-center justify-between gap-2">
            <label for="mill3" class="text-slate-300">3 ejes</label>
            <input id="mill3" type="number" min="0" value="0"
                   class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
          </div>
          <div class="flex items-center justify-between gap-2">
            <label for="mill4" class="text-slate-300">3+2 / 4º eje indexado</label>
            <input id="mill4" type="number" min="0" value="0"
                   class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
          </div>
          <div class="flex items-center justify-between gap-2">
            <label for="mill5" class="text-slate-300">5 ejes simultáneo</label>
            <input id="mill5" type="number" min="0" value="0"
                   class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
          </div>

          <div class="mt-3">
            <label class="block text-xs text-slate-400 mb-1">Nivel 5 ejes recomendado</label>
            <select id="sim5Level"
                    class="w-full px-2 py-1 rounded bg-base-900 border border-slate-600 text-sm">
              <option value="sim5Standard">Simultaneous 5 axis Standard</option>
              <option value="sim5Pro">Simultaneous 5 axis Professional</option>
              <option value="sim5Premium">Simultaneous 5 axis Premium</option>
            </select>
          </div>
        </div>

        <div class="space-y-2">
          <h3 class="text-slate-200 font-medium text-sm">Tornos / Mill-Turn / Wire</h3>
          <div class="flex items-center justify-between gap-2">
            <label for="lathe2" class="text-slate-300">Torno 2 ejes</label>
            <input id="lathe2" type="number" min="0" value="0"
                   class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
          </div>
          <div class="flex items-center justify-between gap-2">
            <label for="latheY" class="text-slate-300">Torno con Y / eje C / herramientas vivas</label>
            <input id="latheY" type="number" min="0" value="0"
                   class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
          </div>
          <div class="flex items-center justify-between gap-2">
            <label for="latheSwiss" class="text-slate-300">Tipo Suizo / Mill-Turn complejo</label>
            <input id="latheSwiss" type="number" min="0" value="0"
                   class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
          </div>
          <div class="flex items-center justify-between gap-2">
            <label for="latheMultiTurret" class="text-slate-300">Multitorreta / 2 husillos</label>
            <input id="latheMultiTurret" type="number" min="0" value="0"
                   class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
          </div>

          <div class="mt-3 space-y-1">
            <div class="flex items-center justify-between gap-2">
              <label for="wire2" class="text-slate-300">Wire EDM 2 ejes</label>
              <input id="wire2" type="number" min="0" value="0"
                     class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
            </div>
            <div class="flex items-center justify-between gap-2">
              <label for="wire4" class="text-slate-300">Wire EDM 2+4 ejes</label>
              <input id="wire4" type="number" min="0" value="0"
                     class="w-20 px-2 py-1 rounded bg-base-900 border border-slate-600 text-right text-sm" />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FORMULARIO: PROCESOS -->
    <section class="bg-base-800/80 border border-slate-700 rounded-2xl p-4 md:p-6 space-y-4">
      <h2 class="text-lg font-semibold flex items-center gap-2">
        2. Tipo de piezas / procesos
        <span class="text-xs font-normal text-slate-400">
          (define iMachining, HSM/HSS, Sim4/5, Turning, Wire)
        </span>
      </h2>
      <div class="grid md:grid-cols-2 gap-4 text-sm">
        <div class="space-y-2">
          <label class="flex items-start gap-2">
            <input id="proc25D" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Producción 2.5D / piezas prismáticas</span>
              <span class="block text-slate-300 text-xs">
                Placas, portapiezas, placas base, pockets, taladrados repetitivos.
              </span>
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input id="procMolds" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Moldes / cavidades 3D</span>
              <span class="block text-slate-300 text-xs">
                Cavidades complejas, acero herramienta, acabados críticos.
              </span>
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input id="procMultiAxis" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Piezas complejas multi-eje (4X / 5X)</span>
              <span class="block text-slate-300 text-xs">
                Impulsores, portaherramientas, álabes, piezas inclinadas.
              </span>
            </span>
          </label>
        </div>

        <div class="space-y-2">
          <label class="flex items-start gap-2">
            <input id="procTurning" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Tornería / Mill-Turn</span>
              <span class="block text-slate-300 text-xs">
                Flechas, bujes, ejes, piezas con fresado en torno, suizo.
              </span>
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input id="procWire" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Wire EDM</span>
              <span class="block text-slate-300 text-xs">
                Cortes por hilo 2 ejes / 2+4 ejes.
              </span>
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input id="procFeatureRich" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Muchas piezas repetitivas por features</span>
              <span class="block text-slate-300 text-xs">
                Placas con muchos taladros, bolsillos y patrones repetidos.
              </span>
            </span>
          </label>
        </div>
      </div>
    </section>

    <!-- FORMULARIO: PRIORIDADES -->
    <section class="bg-base-800/80 border border-slate-700 rounded-2xl p-4 md:p-6 space-y-4">
      <h2 class="text-lg font-semibold flex items-center gap-2">
        3. Prioridades del negocio
        <span class="text-xs font-normal text-slate-400">
          (para decidir iMachining, HSM/HSS, simulation, etc.)
        </span>
      </h2>
      <div class="grid md:grid-cols-2 gap-4 text-sm">
        <div class="space-y-2">
          <label class="flex items-start gap-2">
            <input id="prioCycle" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Reducir tiempos de ciclo / subir vida de herramienta</span>
              <span class="block text-slate-300 text-xs">
                iMachining 2D/3D casi obligado.
              </span>
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input id="prioSurface" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Acabado superficial y menos pulido manual</span>
              <span class="block text-slate-300 text-xs">
                HSM + HSS.
              </span>
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input id="prioRisk" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Bajar riesgo de colisión / máquinas caras</span>
              <span class="block text-slate-300 text-xs">
                Machine Simulation y posts bien hechos.
              </span>
            </span>
          </label>
        </div>

        <div class="space-y-2">
          <label class="flex items-start gap-2">
            <input id="prioFlex" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Flexibilidad multi-máquina / multi-eje</span>
              <span class="block text-slate-300 text-xs">
                4X / 5X, Mill-Turn, Swiss, multitorreta.
              </span>
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input id="prioStandard" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Estandarización y plantillas</span>
              <span class="block text-slate-300 text-xs">
                Feature Recognition, procesos estándar, capacitación.
              </span>
            </span>
          </label>

          <label class="flex items-start gap-2">
            <input id="wantHSR" type="checkbox"
                   class="mt-1 rounded border-slate-600 bg-base-900" />
            <span>
              <span class="font-medium">Quiero HSR además de iMachining 3D</span>
              <span class="block text-slate-300 text-xs">
                Solo si necesitas patrones de desbaste muy específicos o compatibilidad con proyectos antiguos.
              </span>
            </span>
          </label>
        </div>
      </div>
    </section>

    <!-- BOTÓN -->
    <div class="flex justify-end">
      <button onclick="calculateConfig()"
              class="px-4 py-2 rounded-xl bg-accent-500 hover:bg-accent-400 text-base font-medium text-base-900 shadow-md shadow-emerald-500/30">
        Calcular recomendación y costos
      </button>
    </div>

    <!-- RESULTADOS -->
    <section id="resultsSection" class="hidden space-y-6">
      <!-- Resumen corto -->
      <div class="bg-base-800/80 border border-emerald-500/50 rounded-2xl p-4 md:p-5 space-y-2">
        <h2 class="text-lg font-semibold flex items-center gap-2">
          Resultado recomendado
          <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-emerald-500/10 text-emerald-300 border border-emerald-500/40">
            Configuración CAM sugerida
          </span>
        </h2>
        <p id="summaryText" class="text-sm text-slate-200"></p>
      </div>

      <!-- Módulos recomendados -->
      <div class="bg-base-800/80 border border-slate-700 rounded-2xl p-4 md:p-5 space-y-3">
        <div class="flex items-center justify-between gap-2">
          <h3 class="text-base font-semibold">Módulos SolidCAM recomendados</h3>
          <span class="text-xs text-slate-400">Incluye nombre, código de sistema y lógica.</span>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-xs md:text-sm border-separate border-spacing-y-1">
            <thead class="text-slate-300 text-[11px] md:text-xs uppercase tracking-wide">
              <tr>
                <th class="text-left px-2 py-1">Módulo</th>
                <th class="text-left px-2 py-1">Código sistema</th>
                <th class="text-left px-2 py-1">Tipo</th>
                <th class="text-left px-2 py-1">Motivo</th>
              </tr>
            </thead>
            <tbody id="modulesTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Posts y simulación -->
      <div class="bg-base-800/80 border border-slate-700 rounded-2xl p-4 md:p-5 space-y-3">
        <div class="flex items-center justify-between gap-2">
          <h3 class="text-base font-semibold">Postprocesadores y simulación</h3>
          <span class="text-xs text-slate-400">Lo que necesitas para que los códigos salgan correctos.</span>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-xs md:text-sm border-separate border-spacing-y-1">
            <thead class="text-slate-300 text-[11px] md:text-xs uppercase tracking-wide">
              <tr>
                <th class="text-left px-2 py-1">Elemento</th>
                <th class="text-left px-2 py-1">Código sistema</th>
                <th class="text-left px-2 py-1">Máquinas / ejes</th>
                <th class="text-left px-2 py-1">Motivo</th>
              </tr>
            </thead>
            <tbody id="postsTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Servicios -->
      <div class="bg-base-800/80 border border-slate-700 rounded-2xl p-4 md:p-5 space-y-3">
        <div class="flex items-center justify-between gap-2">
          <h3 class="text-base font-semibold">Servicios recomendados (implementación y capacitación)</h3>
          <span class="text-xs text-slate-400">Para que el sistema salga produciendo, no guardado en el cajón.</span>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-xs md:text-sm border-separate border-spacing-y-1">
            <thead class="text-slate-300 text-[11px] md:text-xs uppercase tracking-wide">
              <tr>
                <th class="text-left px-2 py-1">Servicio</th>
                <th class="text-left px-2 py-1">Código sistema</th>
                <th class="text-right px-2 py-1">Precio (USD)</th>
                <th class="text-left px-2 py-1">Motivo</th>
              </tr>
            </thead>
            <tbody id="servicesTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Totales por esquema de licencia -->
      <div class="bg-base-800/80 border border-slate-700 rounded-2xl p-4 md:p-5 space-y-3">
        <div class="flex items-center justify-between gap-2">
          <h3 class="text-base font-semibold">Resumen de costos por esquema de licencia (solo módulos)</h3>
          <span class="text-xs text-slate-400">
            Cálculos con lógica: Trade-in 2Y, Trade-in 3Y y Term según factores de descuento.
          </span>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-xs md:text-sm border-separate border-spacing-y-1">
            <thead class="text-slate-300 text-[11px] md:text-xs uppercase tracking-wide">
              <tr>
                <th class="text-left px-2 py-1">Esquema</th>
                <th class="text-right px-2 py-1">Total módulos (USD)</th>
              </tr>
            </thead>
            <tbody id="totalsTableBody"></tbody>
          </table>
        </div>
        <p class="text-[11px] md:text-xs text-slate-400">
          Nota: Los servicios (implementación y capacitación) se suman aparte como costo único del proyecto.
        </p>
      </div>
    </section>
  </div>

  <script>
    // --- Tabla de precios (extraído de tu lista) ---
    // Valores en USD, por módulo.
    const priceTable = {
      // Milling base y módulos 3D
      milling2_5d: {
        id: 'milling2_5d',
        name: 'SolidCAM Milling (2.5D milling module)',
        sku: 'SSA1008', // paquete en sistema
        type: 'Milling',
        license: 3900,
        sub1: 702,
        licSub1: 4602,
        licSub3: 5584.80
      },
      imachining2d: {
        id: 'imachining2d',
        name: 'iMachining 2D',
        sku: 'SSM-iM2D',
        type: 'Milling',
        license: 4290,
        sub1: 772,
        licSub1: 5062.20,
        licSub3: 6143.28
      },
      imachining3d: {
        id: 'imachining3d',
        name: 'iMachining 3D',
        sku: 'SSM-iM3D',
        type: 'Milling',
        license: 7590,
        sub1: 1366,
        licSub1: 8956.20,
        licSub3: 10868.88
      },
      hsm3d: {
        id: 'hsm3d',
        name: '3D HSM module',
        sku: 'SSA1002',
        type: 'Milling',
        license: 6050,
        sub1: 1089,
        licSub1: 7139.00,
        licSub3: 8663.60
      },
      hss: {
        id: 'hss',
        name: 'HSS module (Simultaneous 3 axis)',
        sku: 'SSA-HSS',
        type: 'Milling',
        license: 1100,
        sub1: 198,
        licSub1: 1298.00,
        licSub3: 1575.20
      },
      hsr: {
        id: 'hsr',
        name: 'HSM Rough milling module - HSR',
        sku: 'SSA1003',
        type: 'Milling',
        license: 1650,
        sub1: 297,
        licSub1: 1947.00,
        licSub3: 2362.80
      },
      sim4: {
        id: 'sim4',
        name: 'Simultaneous 4 axis',
        sku: 'SSM0007',
        type: 'Milling',
        license: 1100,
        sub1: 198,
        licSub1: 1298.00,
        licSub3: 1575.20
      },
      sim5Standard: {
        id: 'sim5Standard',
        name: 'Simultaneous 5 axis Standard',
        sku: 'SSM-SIM5S',
        type: 'Milling',
        license: 4400,
        sub1: 792,
        licSub1: 5192.00,
        licSub3: 6300.80
      },
      sim5Pro: {
        id: 'sim5Pro',
        name: 'Simultaneous 5 axis Professional',
        sku: 'SSM-SIM5P',
        type: 'Milling',
        license: 7700,
        sub1: 1386,
        licSub1: 9086.00,
        licSub3: 11026.40
      },
      sim5Premium: {
        id: 'sim5Premium',
        name: 'Simultaneous 5 axis Premium',
        sku: 'SSM-SIM5X',
        type: 'Milling',
        license: 9900,
        sub1: 1782,
        licSub1: 11682.00,
        licSub3: 14176.80
      },
      rotary: {
        id: 'rotary',
        name: 'Rotary Machining (Screw)',
        sku: 'SSM-ROT',
        type: 'Milling',
        license: 1100,
        sub1: 198,
        licSub1: 1298.00,
        licSub3: 1575.20
      },
      featureRec: {
        id: 'featureRec',
        name: 'Feature recognition',
        sku: 'SSM0004',
        type: 'Milling',
        license: 1100,
        sub1: 198,
        licSub1: 1298.00,
        licSub3: 1575.20
      },

      // Turning y asociados
      turningBase: {
        id: 'turningBase',
        name: 'SolidCAM Turning',
        sku: 'SSA1012',
        type: 'Turning',
        license: 2500,
        sub1: 450,
        licSub1: 2950.00,
        licSub3: 3580.00
      },
      swissType: {
        id: 'swissType',
        name: 'Swiss Type',
        sku: 'SSA1035',
        type: 'Turning',
        license: 6490,
        sub1: 1168,
        licSub1: 7658.20,
        licSub3: 9293.68
      },
      multiTurret: {
        id: 'multiTurret',
        name: 'Multi-Turret Synchronization',
        sku: 'SSA1018',
        type: 'Turning',
        license: 3190,
        sub1: 574,
        licSub1: 3764.20,
        licSub3: 4568.08
      },
      machineSim: {
        id: 'machineSim',
        name: 'Machine simulation',
        sku: 'SSA1039',
        type: 'Simulation',
        license: 1650,
        sub1: 297,
        licSub1: 1947.00,
        licSub3: 2362.80
      },

      // Wire (solo de referencia; sin desglose completo de lic/sub aquí)
      wire2: {
        id: 'wire2',
        name: 'SolidCAM Wirecut 2 axis',
        sku: 'SSA9013',
        type: 'Wire',
        license: 2814,
        sub1: 0,
        licSub1: 2814,
        licSub3: 2814
      },
      wire24: {
        id: 'wire24',
        name: 'SolidCAM Wirecut 2+4 axis',
        sku: 'SSA9014',
        type: 'Wire',
        license: 5145,
        sub1: 0,
        licSub1: 5145,
        licSub3: 5145
      }
    };

    // Servicios (simple, costo único)
    const serviceTable = {
      impl8h: {
        id: 'impl8h',
        name: 'Implementación CAM en sitio 8 h',
        sku: 'SSC-IMPL-8H',
        price: 1000
      },
      capMilling25D: {
        id: 'capMilling25D',
        name: 'Capacitación SolidCAM Milling (2.5D)',
        sku: 'SSC-CAP-MILL25D',
        price: 450
      },
      capHSR: {
        id: 'capHSR',
        name: 'Capacitación HSM Rough milling module - HSR',
        sku: 'SSC0038',
        price: 200
      },
      capHSS: {
        id: 'capHSS',
        name: 'Capacitación HSS module (Simultaneous 3 axis)',
        sku: 'SSC-CAP-HSS',
        price: 200
      }
    };

    function addUnique(list, item) {
      if (!list.find(x => x.id === item.id)) {
        list.push(item);
      }
    }

    function formatMoney(v) {
      return '$ ' + v.toFixed(2);
    }

    function calculateConfig() {
      // Leer máquinas
      const mill3 = parseInt(document.getElementById('mill3').value || '0', 10);
      const mill4 = parseInt(document.getElementById('mill4').value || '0', 10);
      const mill5 = parseInt(document.getElementById('mill5').value || '0', 10);
      const lathe2 = parseInt(document.getElementById('lathe2').value || '0', 10);
      const latheY = parseInt(document.getElementById('latheY').value || '0', 10);
      const latheSwiss = parseInt(document.getElementById('latheSwiss').value || '0', 10);
      const latheMultiTurret = parseInt(document.getElementById('latheMultiTurret').value || '0', 10);
      const wire2 = parseInt(document.getElementById('wire2').value || '0', 10);
      const wire4 = parseInt(document.getElementById('wire4').value || '0', 10);
      const sim5Level = document.getElementById('sim5Level').value;

      const hasMilling = (mill3 + mill4 + mill5) > 0;
      const hasTurning = (lathe2 + latheY + latheSwiss + latheMultiTurret) > 0;
      const hasWire = (wire2 + wire4) > 0;

      // Procesos
      const proc25D = document.getElementById('proc25D').checked;
      const procMolds = document.getElementById('procMolds').checked;
      const procMultiAxis = document.getElementById('procMultiAxis').checked;
      const procTurning = document.getElementById('procTurning').checked;
      const procWire = document.getElementById('procWire').checked;
      const procFeatureRich = document.getElementById('procFeatureRich').checked;

      // Prioridades
      const prioCycle = document.getElementById('prioCycle').checked;
      const prioSurface = document.getElementById('prioSurface').checked;
      const prioRisk = document.getElementById('prioRisk').checked;
      const prioFlex = document.getElementById('prioFlex').checked;
      const prioStandard = document.getElementById('prioStandard').checked;
      const wantHSR = document.getElementById('wantHSR').checked;

      const modules = [];
      const posts = [];
      const services = [];

      // --- LÓGICA MILLING ---
      if (hasMilling) {
        // Base Milling 2.5D
        addUnique(modules, {
          ...priceTable.milling2_5d,
          reason: 'Base obligatoria para cualquier centro de maquinado (2.5D, setups, herramientas).'
        });

        // iMachining 2D/3D cuando prioridad es ciclo/vida o moldes
        if (prioCycle || procMolds || proc25D) {
          addUnique(modules, {
            ...priceTable.imachining2d,
            reason: 'Reducción de tiempos de ciclo 2.5D y estandarización de desbastes en producción.'
          });
          addUnique(modules, {
            ...priceTable.imachining3d,
            reason: 'Roughing y rest roughing 3D automático para moldes / piezas complejas.'
          });
        }

        // HSM / HSS para moldes / acabado
        if (procMolds || prioSurface) {
          addUnique(modules, {
            ...priceTable.hsm3d,
            reason: 'Acabado global 3D de cavidades y superficies complejas.'
          });
          addUnique(modules, {
            ...priceTable.hss,
            reason: 'Acabado local de áreas críticas (fillets, costillas, zonas de pulido fino).'
          });
        }

        // HSR solo si lo pide explícitamente
        if (wantHSR) {
          addUnique(modules, {
            ...priceTable.hsr,
            reason: 'Roughing 3D clásico para patrones específicos o compatibilidad con proyectos legacy.'
          });
        }

        // Simultaneous 4 axis
        if (mill4 > 0 || (procMultiAxis && (mill3 + mill4 + mill5) > 0)) {
          addUnique(modules, {
            ...priceTable.sim4,
            reason: 'Trabajo 3+2 / 4º eje en indexado o simultáneo donde se requiera rotación continua.'
          });
        }

        // Simultaneous 5 axis (nivel elegido)
        if (mill5 > 0 || (procMultiAxis && mill5 > 0)) {
          const sim5 = priceTable[sim5Level] || priceTable.sim5Standard;
          addUnique(modules, {
            ...sim5,
            reason: 'Estrategias simultáneas 5X para piezas complejas multi-eje.'
          });
        }

        // Feature recognition si el cliente está en mucha producción 2.5D
        if (procFeatureRich || prioStandard) {
          addUnique(modules, {
            ...priceTable.featureRec,
            reason: 'Programación más rápida de placas y piezas prismáticas con muchos features repetitivos.'
          });
        }
      }

      // --- LÓGICA TURNING / MILL-TURN ---
      if (hasTurning || procTurning) {
        addUnique(modules, {
          ...priceTable.turningBase,
          reason: 'Base para torneado (desbaste, acabado, roscado, etc.).'
        });

        if (latheSwiss > 0) {
          addUnique(modules, {
            ...priceTable.swissType,
            reason: 'Requerido para máquinas tipo suizo / multicanal con guía móvil.'
          });
        }

        if (latheMultiTurret > 0) {
          addUnique(modules, {
            ...priceTable.multiTurret,
            reason: 'Sincronización de multitorreta / doble husillo para Mill-Turn complejo.'
          });
        }
      }

      // --- LÓGICA WIRE ---
      if (hasWire || procWire) {
        if (wire2 > 0) {
          addUnique(modules, {
            ...priceTable.wire2,
            reason: 'Wire EDM 2 ejes para cortes estándar.'
          });
        }
        if (wire4 > 0) {
          addUnique(modules, {
            ...priceTable.wire24,
            reason: 'Wire EDM 2+4 ejes cuando se requiere conicidad o geometrías inclinadas.'
          });
        }
      }

      // --- Machine Simulation si hay riesgo o 5X / multitorreta ---
      if (prioRisk && (hasMilling || hasTurning) || mill5 > 0 || latheMultiTurret > 0 || latheSwiss > 0) {
        addUnique(modules, {
          ...priceTable.machineSim,
          reason: 'Reducción de riesgo de colisión en 5X, Mill-Turn o máquinas costosas.'
        });
      }

      // --- POSTS ---
      if (mill3 + mill4 + mill5 > 0) {
        posts.push({
          id: 'postMill3',
          name: 'Post-Procesador Milling 3 Axis | G/M Code | General',
          sku: 'SSM0136',
          machines: `${mill3}x 3 ejes`,
          reason: 'Salida de código G correcta para centros 3 ejes.',
        });
      }
      if (mill4 > 0) {
        posts.push({
          id: 'postMill4',
          name: 'Post-Procesador Milling 4 Axis | G/M Code | General',
          sku: 'SSM0101',
          machines: `${mill4}x 4º eje / 3+2`,
          reason: 'Soporte de indexado y/o 4º eje continuo.',
        });
      }
      if (mill5 > 0) {
        posts.push({
          id: 'postMill5',
          name: 'Post-Procesador Milling 5 Axis | G/M Code | General',
          sku: 'SSM0102',
          machines: `${mill5}x 5 ejes`,
          reason: 'Salida 5X simultáneo alineada con la cinemática real.',
        });
      }
      if (lathe2 + latheY > 0) {
        posts.push({
          id: 'postTurn',
          name: 'Postprocessor Turning',
          sku: 'SSM0088',
          machines: `${lathe2 + latheY}x Tornos`,
          reason: 'Torneado 2 ejes y con eje C/Y.',
        });
      }
      if (latheY > 0 || latheMultiTurret > 0) {
        posts.push({
          id: 'postMT4',
          name: 'Post-Procesador MillTurn 4 Axis | G/M Code | General',
          sku: 'SSM0100',
          machines: `${latheY + latheMultiTurret}x Mill-Turn`,
          reason: 'Coordinación de torneado + fresado en torno.',
        });
      }
      if (latheSwiss > 0) {
        posts.push({
          id: 'postMT5',
          name: 'Postprecessor MillTurn 5 axis - G/M Code - General',
          sku: 'SSM0098',
          machines: `${latheSwiss}x Suizo / Mill-Turn complejo`,
          reason: 'Soporte de canales múltiples y ejes adicionales.',
        });
      }
      if (wire2 > 0) {
        posts.push({
          id: 'postWire2',
          name: 'PostProcessor Wirecut 2 axis',
          sku: 'SSM0134',
          machines: `${wire2}x Wire 2X`,
          reason: 'Código correcto para corte 2 ejes.',
        });
      }
      if (wire4 > 0) {
        posts.push({
          id: 'postWire4',
          name: 'PostProcessor Wirecut 4 axis',
          sku: 'SSM0135',
          machines: `${wire4}x Wire 2+4X`,
          reason: 'Soporta interpolación de 4 ejes en hilo.',
        });
      }

      // --- SERVICIOS ---
      if (modules.length > 0) {
        // Siempre sugerir al menos 1 día de implementación
        addUnique(services, {
          ...serviceTable.impl8h,
          reason: 'Arranque del sistema: instalación, posts, wizard de iMachining y prueba con piezas reales.'
        });
      }
      if (hasMilling) {
        addUnique(services, {
          ...serviceTable.capMilling25D,
          reason: 'Base para que el equipo domine 2.5D, setups y flujo general de SolidCAM.'
        });
      }
      if (modules.find(m => m.id === 'hsr')) {
        addUnique(services, {
          ...serviceTable.capHSR,
          reason: 'Uso correcto de HSR en moldes / roughing 3D clásico.'
        });
      }
      if (modules.find(m => m.id === 'hss')) {
        addUnique(services, {
          ...serviceTable.capHSS,
          reason: 'Acabado local y control fino de superficies críticas en moldes.'
        });
      }

      // --- RESÚMENES / TOTALES ---
      let totalLicense = 0;
      let totalSub1 = 0;
      let totalLicSub1 = 0;
      let totalLicSub3 = 0;

      modules.forEach(m => {
        totalLicense += m.license || 0;
        totalSub1 += m.sub1 || 0;
        totalLicSub1 += m.licSub1 || 0;
        totalLicSub3 += m.licSub3 || 0;
      });

      // Fórmulas Trade-in / Term
      const tradeIn2Factor = 1 - 0.1864;
      const tradeIn3Factor = 1 - 0.2039;
      const termFactor = 1 - 0.587;

      const totalTradeIn2 = totalLicSub1 * tradeIn2Factor;
      const totalTradeIn3 = totalLicSub3 * tradeIn3Factor;
      const totalTerm = totalLicense * termFactor;

      const totalServices = services.reduce((acc, s) => acc + (s.price || 0), 0);

      // --- Render resumen corto ---
      const summaryLines = [];
      if (hasMilling) summaryLines.push('Incluye base de Milling 2.5D y módulos 3D según procesos (iMachining, HSM, HSS, HSR opcional).');
      if (hasTurning) summaryLines.push('Configura Turning / Mill-Turn según tornos simples, con Y, suizo o multitorreta.');
      if (hasWire) summaryLines.push('Agrega módulos de Wire EDM según máquinas 2X / 2+4X.');
      if (prioCycle) summaryLines.push('La prioridad de ciclo/vida de herramienta activa iMachining 2D/3D.');
      if (prioSurface) summaryLines.push('La prioridad de acabado activa HSM y HSS para moldes / superficies complejas.');
      if (prioRisk) summaryLines.push('Se recomienda Machine Simulation y posts específicos para reducir riesgo de colisión.');
      if (summaryLines.length === 0) summaryLines.push('No se detectaron máquinas ni procesos; ajusta los valores para obtener una recomendación.');

      document.getElementById('summaryText').textContent = summaryLines.join(' ');

      // --- Render tablas ---
      const modulesBody = document.getElementById('modulesTableBody');
      modulesBody.innerHTML = '';
      modules.forEach(m => {
        const tr = document.createElement('tr');
        tr.className = 'bg-base-900/60 hover:bg-base-900';
        tr.innerHTML = `
          <td class="px-2 py-1 align-top">${m.name}</td>
          <td class="px-2 py-1 align-top text-xs text-emerald-300">${m.sku || '-'}</td>
          <td class="px-2 py-1 align-top">${m.type || '-'}</td>
          <td class="px-2 py-1 align-top text-slate-300 text-xs">${m.reason || ''}</td>
        `;
        modulesBody.appendChild(tr);
      });

      const postsBody = document.getElementById('postsTableBody');
      postsBody.innerHTML = '';
      posts.forEach(p => {
        const tr = document.createElement('tr');
        tr.className = 'bg-base-900/60 hover:bg-base-900';
        tr.innerHTML = `
          <td class="px-2 py-1 align-top">${p.name}</td>
          <td class="px-2 py-1 align-top text-xs text-emerald-300">${p.sku || '-'}</td>
          <td class="px-2 py-1 align-top text-xs">${p.machines || '-'}</td>
          <td class="px-2 py-1 align-top text-slate-300 text-xs">${p.reason || ''}</td>
        `;
        postsBody.appendChild(tr);
      });

      const servicesBody = document.getElementById('servicesTableBody');
      servicesBody.innerHTML = '';
      services.forEach(s => {
        const tr = document.createElement('tr');
        tr.className = 'bg-base-900/60 hover:bg-base-900';
        tr.innerHTML = `
          <td class="px-2 py-1 align-top">${s.name}</td>
          <td class="px-2 py-1 align-top text-xs text-emerald-300">${s.sku || '-'}</td>
          <td class="px-2 py-1 align-top text-right">${formatMoney(s.price || 0)}</td>
          <td class="px-2 py-1 align-top text-slate-300 text-xs">${s.reason || ''}</td>
        `;
        servicesBody.appendChild(tr);
      });

      const totalsBody = document.getElementById('totalsTableBody');
      totalsBody.innerHTML = '';

      function addTotalRow(label, value) {
        const tr = document.createElement('tr');
        tr.className = 'bg-base-900/60 hover:bg-base-900';
        tr.innerHTML = `
          <td class="px-2 py-1 align-top">${label}</td>
          <td class="px-2 py-1 align-top text-right">${formatMoney(value)}</td>
        `;
        totalsBody.appendChild(tr);
      }

      addTotalRow('Solo licencia (suma de License)', totalLicense);
      addTotalRow('Solo suscripción 1 año (Sub 1Y)', totalSub1);
      addTotalRow('Licencia + Suscripción 1 año', totalLicSub1);
      addTotalRow('Licencia + Suscripción 3 años', totalLicSub3);
      addTotalRow('Trade-in 2 años (≈ Lic+Sub 1Y - 18.64%)', totalTradeIn2);
      addTotalRow('Trade-in 3 años (≈ Lic+Sub 3Y - 20.39%)', totalTradeIn3);
      addTotalRow('Term License (≈ Licencia - 58.7%)', totalTerm);
      addTotalRow('Servicios (implementación + capacitación, costo único)', totalServices);

      // Mostrar sección
      document.getElementById('resultsSection').classList.remove('hidden');
    }
  </script>
</body>
</html>
