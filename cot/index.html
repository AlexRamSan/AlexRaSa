<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Configurador de licencias SolidCAM</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            base: { 900: '#020617', 800: '#0f172a', 700: '#1e293b' },
            accent: { 500: '#e11d48' }
          }
        }
      }
    };
  </script>
</head>
<body class="bg-base-900 text-slate-100 min-h-screen">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <header class="mb-6">
      <h1 class="text-2xl md:text-3xl font-bold mb-2">
        Configurador de licencias SolidCAM
      </h1>
      <p class="text-sm text-slate-300">
        Ingresa cuántas máquinas tienes, qué tecnologías usan (3+2, 5 ejes, etc.) y el tipo de
        maquinado. El configurador recomienda módulos, postprocesadores y capacitaciones
        con sus códigos y precios de lista.
      </p>
    </header>

    <!-- Formulario -->
    <section class="grid md:grid-cols-2 gap-6 mb-8">
      <!-- Parque de máquinas -->
      <div class="bg-base-800 rounded-xl p-4 md:p-5 shadow-lg shadow-black/30">
        <h2 class="font-semibold mb-3 text-lg">1. Parque de máquinas</h2>

        <div class="space-y-4 text-sm">
          <div>
            <p class="text-slate-300 mb-1 font-semibold">Fresadoras / centros de maquinado</p>
            <div class="flex items-center justify-between gap-3 mb-2">
              <label for="qtyMill3" class="flex-1">Máquinas 3 ejes</label>
              <input id="qtyMill3" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
            <div class="flex items-center justify-between gap-3 mb-2">
              <label for="qtyMill32" class="flex-1">Máquinas 3+2 / 4–5 ejes indexado</label>
              <input id="qtyMill32" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
            <div class="flex items-center justify-between gap-3">
              <label for="qtyMill5" class="flex-1">Máquinas 5 ejes simultáneo</label>
              <input id="qtyMill5" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
          </div>

          <div>
            <p class="text-slate-300 mb-1 font-semibold">Tornos / Mill-Turn</p>
            <div class="flex items-center justify-between gap-3 mb-2">
              <label for="qtyLathe2" class="flex-1">Tornos 2 ejes</label>
              <input id="qtyLathe2" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
            <div class="flex items-center justify-between gap-3 mb-2">
              <label for="qtyLatheY" class="flex-1">Tornos con eje Y / herramientas vivas</label>
              <input id="qtyLatheY" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
            <div class="flex items-center justify-between gap-3 mb-2">
              <label for="qtySwiss" class="flex-1">Tornos tipo suizo</label>
              <input id="qtySwiss" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
            <div class="flex items-center justify-between gap-3">
              <label for="qtyMultiTurret" class="flex-1">Tornos multitorreta / Mill-Turn complejo</label>
              <input id="qtyMultiTurret" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
          </div>

          <div>
            <p class="text-slate-300 mb-1 font-semibold">EDM por hilo</p>
            <div class="flex items-center justify-between gap-3 mb-2">
              <label for="qtyWire2" class="flex-1">Wirecut 2 ejes</label>
              <input id="qtyWire2" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
            <div class="flex items-center justify-between gap-3">
              <label for="qtyWire4" class="flex-1">Wirecut 2+4 ejes</label>
              <input id="qtyWire4" type="number" min="0" value="0"
                     class="w-20 bg-base-900 border border-slate-600 rounded px-2 py-1 text-right text-sm">
            </div>
          </div>
        </div>
      </div>

      <!-- Tecnologías / capacidades -->
      <div class="bg-base-800 rounded-xl p-4 md:p-5 shadow-lg shadow-black/30">
        <h2 class="font-semibold mb-3 text-lg">2. Tecnologías de maquinado</h2>

        <div class="space-y-4 text-sm">
          <div>
            <p class="text-slate-300 mb-1 font-semibold">iMachining / desbaste</p>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantIM2D" class="rounded border-slate-500 bg-base-900">
              <span>Desbaste 2.5D (cavidades, contornos, placas)</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantIM3D" class="rounded border-slate-500 bg-base-900">
              <span>Desbaste 3D (troqueles, moldes, cavidades profundas)</span>
            </label>
            <p class="text-xs text-slate-400 mt-1">
              Si seleccionas 3D, se asume paquete iMachining 2D + 3D.
            </p>
          </div>

          <div>
            <p class="text-slate-300 mb-1 font-semibold">Moldes / superficies / alto acabado</p>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantHSM3D" class="rounded border-slate-500 bg-base-900">
              <span>Acabado 3D HSM (moldes, formas libres)</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantHSS" class="rounded border-slate-500 bg-base-900">
              <span>HSS (superficies locales / correcciones en zonas)</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantHSR" class="rounded border-slate-500 bg-base-900">
              <span>HSR (rough 3D de alto volumen)</span>
            </label>
          </div>

          <div>
            <p class="text-slate-300 mb-1 font-semibold">5 ejes simultáneo</p>
            <label class="block text-xs text-slate-400 mb-1">
              Nivel de 5 ejes requerido (si tienes máquinas 5X):
            </label>
            <select id="fiveAxisLevel" class="w-full bg-base-900 border border-slate-600 rounded px-2 py-1 text-sm">
              <option value="">Sin 5 ejes simultáneo</option>
              <option value="standard">5 ejes Standard</option>
              <option value="pro">5 ejes Professional</option>
              <option value="premium">5 ejes Premium</option>
            </select>
          </div>

          <div>
            <p class="text-slate-300 mb-1 font-semibold">Medición / simulación</p>
            <div class="flex flex-col gap-1 mb-2">
              <label class="flex items-center gap-2">
                <input type="radio" name="probeLevel" value="" checked class="border-slate-500 bg-base-900">
                <span>Sin palpador</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="radio" name="probeLevel" value="l1" class="border-slate-500 bg-base-900">
                <span>Solid Probe Level 1 (origen / home)</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="radio" name="probeLevel" value="l2" class="border-slate-500 bg-base-900">
                <span>Solid Probe Level 2 (origen + medición)</span>
              </label>
            </div>

            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantMachineSim" class="rounded border-slate-500 bg-base-900">
              <span>Simulación de máquina / G-code</span>
            </label>
          </div>

          <div>
            <p class="text-slate-300 mb-1 font-semibold">Extras</p>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantFeatureRec" class="rounded border-slate-500 bg-base-900">
              <span>Feature recognition (reconocimiento de features)</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantCimco" class="rounded border-slate-500 bg-base-900">
              <span>CIMCO Editor Professional</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantOperators" class="rounded border-slate-500 bg-base-900">
              <span>SolidCAM for Operators (Editor + Simulator)</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="wantFloating" class="rounded border-slate-500 bg-base-900">
              <span>Licencia flotante SolidCAM</span>
            </label>
          </div>
        </div>
      </div>
    </section>

    <div class="mb-6 flex justify-between items-center gap-4">
      <button id="calcBtn"
        class="inline-flex items-center justify-center px-4 py-2 rounded-lg bg-accent-500 text-sm font-semibold shadow-lg shadow-accent-500/40 hover:bg-rose-600 transition">
        Calcular módulos y costos
      </button>
      <p class="text-xs text-slate-400 max-w-xl">
        Calcula una estación CAM. Si usas más estaciones, multiplica los totales
        o repite la configuración por estación.
      </p>
    </div>

    <!-- Resultados -->
    <section id="resultsSection" class="hidden space-y-4">
      <div class="bg-base-800 rounded-xl p-4 md:p-5 shadow-lg shadow-black/30">
        <h2 class="font-semibold mb-2 text-lg">Módulos recomendados</h2>
        <ul id="modulesList" class="list-disc list-inside text-sm text-slate-200 space-y-1"></ul>
      </div>

      <div class="bg-base-800 rounded-xl p-4 md:p-5 shadow-lg shadow-black/30 overflow-x-auto">
        <h2 class="font-semibold mb-3 text-lg">Desglose de inversión en módulos (USD)</h2>
        <table class="min-w-full text-xs border-separate border-spacing-y-1">
          <thead>
            <tr class="text-[11px] text-slate-300">
              <th class="text-left  px-2 py-1">Módulo</th>
              <th class="text-right px-2 py-1">Licencia</th>
              <th class="text-right px-2 py-1">Subs 1Y</th>
              <th class="text-right px-2 py-1">Subs 3Y</th>
              <th class="text-right px-2 py-1">Lic+Subs 1Y</th>
              <th class="text-right px-2 py-1">Lic+Subs 3Y</th>
              <th class="text-right px-2 py-1">Trade-in 2Y</th>
              <th class="text-right px-2 py-1">Trade-in 3Y</th>
              <th class="text-right px-2 py-1">Term</th>
              <th class="text-left  px-2 py-1">Código sistema (1Y)</th>
              <th class="text-right px-2 py-1">Precio paquete 1Y</th>
            </tr>
          </thead>
          <tbody id="pricingBody"></tbody>
          <tfoot>
            <tr class="bg-base-700 font-semibold">
              <td class="px-2 py-1 text-right">Totales</td>
              <td class="px-2 py-1 text-right" id="totLicense"></td>
              <td class="px-2 py-1 text-right" id="totSubs1"></td>
              <td class="px-2 py-1 text-right" id="totSubs3"></td>
              <td class="px-2 py-1 text-right" id="totLicSubs1"></td>
              <td class="px-2 py-1 text-right" id="totLicSubs3"></td>
              <td class="px-2 py-1 text-right" id="totTrade2"></td>
              <td class="px-2 py-1 text-right" id="totTrade3"></td>
              <td class="px-2 py-1 text-right" id="totTerm"></td>
              <td class="px-2 py-1 text-right">Total paquetes</td>
              <td class="px-2 py-1 text-right" id="totCrm"></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Postprocesadores -->
      <div class="bg-base-800 rounded-xl p-4 md:p-5 shadow-lg shadow-black/30 overflow-x-auto">
        <h2 class="font-semibold mb-3 text-lg">Postprocesadores sugeridos</h2>
        <p class="text-xs text-slate-400 mb-2">
          Nota: el post de fresado 3 ejes se considera sin costo (bonificado), ajusta en la oferta
          según la política comercial.
        </p>
        <table class="min-w-full text-xs border-separate border-spacing-y-1">
          <thead>
            <tr class="text-[11px] text-slate-300">
              <th class="text-left px-2 py-1">Código</th>
              <th class="text-left px-2 py-1">Descripción</th>
              <th class="text-right px-2 py-1">Cantidad</th>
              <th class="text-right px-2 py-1">Precio unitario</th>
              <th class="text-right px-2 py-1">Subtotal</th>
              <th class="text-left px-2 py-1">Nota</th>
            </tr>
          </thead>
          <tbody id="postsBody"></tbody>
          <tfoot>
            <tr class="bg-base-700 font-semibold">
              <td colspan="4" class="px-2 py-1 text-right">Total postprocesadores</td>
              <td class="px-2 py-1 text-right" id="postsTotal"></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Capacitaciones -->
      <div class="bg-base-800 rounded-xl p-4 md:p-5 shadow-lg shadow-black/30 overflow-x-auto mb-4">
        <h2 class="font-semibold mb-3 text-lg">Capacitaciones sugeridas</h2>
        <table class="min-w-full text-xs border-separate border-spacing-y-1">
          <thead>
            <tr class="text-[11px] text-slate-300">
              <th class="text-left px-2 py-1">Código</th>
              <th class="text-left px-2 py-1">Descripción</th>
              <th class="text-right px-2 py-1">Cantidad</th>
              <th class="text-right px-2 py-1">Precio unitario</th>
              <th class="text-right px-2 py-1">Subtotal</th>
            </tr>
          </thead>
          <tbody id="trainingBody"></tbody>
          <tfoot>
            <tr class="bg-base-700 font-semibold">
              <td colspan="4" class="px-2 py-1 text-right">Total capacitaciones</td>
              <td class="px-2 py-1 text-right" id="trainingTotal"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </section>
  </div>

  <script>
    // --- Tabla de precios de módulos (lista oficial + códigos de sistema) ---
    const PRICE_TABLE = {
      milling_25d: {
        label: 'SolidCAM Milling (2.5D milling module)',
        license: 3900, subs1: 702, subs3: 1684.80,
        licSubs1: 4602.00, licSubs3: 5584.80,
        trade2: 3744, trade3: 4446, term: 1610.70,
        crmCode: 'SSA1008',
        crmName: 'Package SolidCAM Milling (2.5D milling module)',
        crmPrice: 4602.00
      },
      milling_imach2d: {
        label: 'SolidCAM Milling + iMachining 2D',
        license: 4290, subs1: 772, subs3: 1853.28,
        licSubs1: 5062.20, licSubs3: 6143.28,
        trade2: 4118, trade3: 4891, term: 1771.77,
        crmCode: null, crmName: null, crmPrice: null
      },
      milling_imach2d3d: {
        label: 'SolidCAM Milling + iMachining 2D/3D',
        license: 7590, subs1: 1366, subs3: 3278.88,
        licSubs1: 8956.20, licSubs3: 10868.88,
        trade2: 7286, trade3: 8653, term: 3134.67,
        crmCode: null, crmName: null, crmPrice: null
      },
      feature_rec: {
        label: 'Feature recognition',
        license: 1100, subs1: 198, subs3: 475.20,
        licSubs1: 1298.00, licSubs3: 1575.20,
        trade2: 1056, trade3: 1254, term: 454.30,
        crmCode: 'SSM0004',
        crmName: '+ Feature recognition',
        crmPrice: 1100.00
      },
      hsm3d: {
        label: '3D HSM module',
        license: 6050, subs1: 1089, subs3: 2613.60,
        licSubs1: 7139.00, licSubs3: 8663.60,
        trade2: 5808, trade3: 6897, term: 2498.65,
        crmCode: null, crmName: null, crmPrice: null
      },
      hss: {
        label: 'HSS module (Simultaneous 3 axis)',
        license: 1100, subs1: 198, subs3: 475.20,
        licSubs1: 1298.00, licSubs3: 1575.20,
        trade2: 1056, trade3: 1254, term: 454.30,
        crmCode: null, crmName: null, crmPrice: null
      },
      hsr: {
        label: 'HSM Rough milling module - HSR',
        license: 1650, subs1: 297, subs3: 712.80,
        licSubs1: 1947.00, licSubs3: 2362.80,
        trade2: 1584, trade3: 1881, term: 681.45,
        crmCode: null, crmName: null, crmPrice: null
      },
      sim4: {
        label: 'Simultaneous 4 axis',
        license: 1100, subs1: 198, subs3: 475.20,
        licSubs1: 1298.00, licSubs3: 1575.20,
        trade2: 1056, trade3: 1254, term: 454.30,
        crmCode: 'SSM0007',
        crmName: '+ Simultaneous 4 axis',
        crmPrice: 1100.00
      },
      sim5_standard: {
        label: 'Simultaneous 5 axis Standard',
        license: 4400, subs1: 792, subs3: 1900.80,
        licSubs1: 5192.00, licSubs3: 6300.80,
        trade2: 4224, trade3: 5016, term: 1817.20,
        crmCode: null, crmName: null, crmPrice: null
      },
      sim5_pro: {
        label: 'Simultaneous 5 axis Professional',
        license: 7700, subs1: 1386, subs3: 3326.40,
        licSubs1: 9086.00, licSubs3: 11026.40,
        trade2: 7392, trade3: 8778, term: 3180.10,
        crmCode: null, crmName: null, crmPrice: null
      },
      sim5_premium: {
        label: 'Simultaneous 5 axis Premium',
        license: 9900, subs1: 1782, subs3: 4276.80,
        licSubs1: 11682.00, licSubs3: 14176.80,
        trade2: 9504, trade3: 11286, term: 4088.70,
        crmCode: null, crmName: null, crmPrice: null
      },
      rotary: {
        label: 'Rotary Machining (Screw)',
        license: 1100, subs1: 198, subs3: 475.20,
        licSubs1: 1298.00, licSubs3: 1575.20,
        trade2: 1056, trade3: 1254, term: 454.30,
        crmCode: null, crmName: null, crmPrice: null
      },
      turning_core: {
        label: 'SolidCAM Turning',
        license: 2500, subs1: 450, subs3: 1080.00,
        licSubs1: 2950.00, licSubs3: 3580.00,
        trade2: 2400, trade3: 2850, term: 1032.50,
        crmCode: 'SSA1012',
        crmName: 'Package SolidCAM Turning',
        crmPrice: 2950.00
      },
      swiss_type: {
        label: 'Swiss Type',
        license: 6490, subs1: 1168, subs3: 2803.68,
        licSubs1: 7658.20, licSubs3: 9293.68,
        trade2: 6230, trade3: 7399, term: 2680.37,
        crmCode: null, crmName: null, crmPrice: null
      },
      multi_turret: {
        label: 'Multi-Turret Synchronization',
        license: 3190, subs1: 574, subs3: 1378.08,
        licSubs1: 3764.20, licSubs3: 4568.08,
        trade2: 3062, trade3: 3637, term: 1317.47,
        crmCode: null, crmName: null, crmPrice: null
      },
      machine_sim: {
        label: 'Integration (G-Code simulation) / Machine simulation',
        license: 1100, subs1: 198, subs3: 0,
        licSubs1: 1298.00, licSubs3: 1100.00,
        trade2: 1056, trade3: 1254, term: 454.30,
        crmCode: 'SSA1039',
        crmName: 'Package Integration (G-Code simulation)',
        crmPrice: 1298.00
      },
      probe_l1: {
        label: 'Solid Probe Level 1 - Home Position',
        license: 2090, subs1: 376, subs3: 902.88,
        licSubs1: 2466.20, licSubs3: 2992.88,
        trade2: 2006, trade3: 2383, term: 863.17,
        crmCode: 'SSA1036',
        crmName: 'Package Solid Probe Level 1 - Home Position',
        crmPrice: 2467.00
      },
      probe_l2: {
        label: 'Solid Probe Level 2 - Home Position & Measurement',
        license: 4290, subs1: 772, subs3: 1853.28,
        licSubs1: 5062.20, licSubs3: 6143.28,
        trade2: 4118, trade3: 4891, term: 1771.77,
        crmCode: 'SSA1016',
        crmName: 'Package Solid Probe Level 2 - Home Position & Measurement',
        crmPrice: 5063.00
      },
      cimco: {
        label: 'CIMCO Editor Professional',
        license: 550, subs1: 99, subs3: 237.60,
        licSubs1: 649.00, licSubs3: 787.60,
        trade2: 528, trade3: 627, term: 227.15,
        crmCode: null, crmName: null, crmPrice: null
      },
      operators_editor: {
        label: 'SolidCAM for Operators Editor',
        license: 3190, subs1: 574, subs3: 1378.08,
        licSubs1: 3764.20, licSubs3: 4568.08,
        trade2: 3062, trade3: 3637, term: 1317.47,
        crmCode: 'SSA1048',
        crmName: 'Package SolidCAM for Operators Editor',
        crmPrice: 3765.00
      },
      operators_sim: {
        label: 'SolidCAM for Operators Simulator',
        license: 2090, subs1: 376, subs3: 902.88,
        licSubs1: 2466.20, licSubs3: 2992.88,
        trade2: 2006, trade3: 2383, term: 863.17,
        crmCode: 'SSA1049',
        crmName: 'Package SolidCAM for Operators Simulator',
        crmPrice: 2467.00
      },
      floating_cam: {
        label: 'Floating license fee SolidCAM - one time fee',
        license: 1320, subs1: 0, subs3: 0,
        licSubs1: 1320.00, licSubs3: 0,
        trade2: 600, trade3: 792, term: 462.00,
        crmCode: null, crmName: null, crmPrice: null
      },
      dcam_standard: {
        label: 'DCAMCUT / Wirecut (referencial)',
        license: 5520, subs1: 715, subs3: 0,
        licSubs1: null, licSubs3: null,
        trade2: null, trade3: null, term: null,
        crmCode: null, crmName: null, crmPrice: null
      }
    };

    // --- Postprocesadores (tu lista de sistema) ---
    const POST_TABLE = {
      mill3: {
        code: 'SSM0136',
        label: 'Post-Procesador Milling 3 Axis | G/M Code | General',
        price: 0,
        note: '3 ejes, normalmente bonificado / sin costo'
      },
      mill4: {
        code: 'SSM0101',
        label: 'Post-Procesador Milling 4 Axis | G/M Code | General',
        price: 500,
        note: ''
      },
      mill5: {
        code: 'SSM0102',
        label: 'Post-Procesador Milling 5 Axis | G/M Code | General',
        price: 1250,
        note: ''
      },
      turn: {
        code: 'SSM0088',
        label: 'Postprocessor Turning',
        price: 2500,
        note: ''
      },
      millturn4: {
        code: 'SSM0100',
        label: 'Post-Procesador MillTurn 4 Axis | G/M Code | General',
        price: 700,
        note: ''
      },
      millturn5: {
        code: 'SSM0098',
        label: 'Postprecessor MillTurn 5 axis - GM Code - General',
        price: 1500,
        note: ''
      },
      wire2: {
        code: 'SSM0134',
        label: 'PostProcessor Wirecut 2 axis',
        price: 425,
        note: ''
      },
      wire4: {
        code: 'SSM0135',
        label: 'PostProcessor Wirecut 4 axis',
        price: 575,
        note: ''
      }
    };

    // --- Capacitaciones (tu lista de sistema) ---
    const TRAINING_TABLE = {
      sim4_pkg: {
        code: 'SSC0041',
        label: 'Capacitación + Simultaneous 4 axis',
        price: 100
      },
      sim5_pkg: {
        code: 'SSC0042',
        label: 'Capacitación + Simultaneous 5 axis',
        price: 450
      },
      hsm3d_hsr: {
        code: 'SSC0036',
        label: 'Capacitación 3D HSM module + HSR Milling',
        price: 250
      },
      idx4: {
        code: 'SSC0043',
        label: 'Capacitación 4 axis indexing',
        price: 100
      },
      idx5: {
        code: 'SSC0044',
        label: 'Capacitación 5 axis indexing',
        price: 100
      },
      feat: {
        code: 'SSC0035',
        label: 'Capacitación Feature recognition',
        price: 100
      },
      hsr: {
        code: 'SSC0038',
        label: 'Capacitación HSM Rough milling module - HSR',
        price: 200
      },
      workshop: {
        code: 'SSC0066',
        label: 'Taller de Capacitación SOLIDCAM',
        price: 320
      }
    };

    function formatMoney(value) {
      if (value == null || isNaN(value)) return '-';
      return '$ ' + value.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function intVal(id) {
      const v = document.getElementById(id).value || '0';
      const n = parseInt(v, 10);
      return isNaN(n) ? 0 : n;
    }

    function collectFormData() {
      const probeRadios = document.querySelectorAll('input[name="probeLevel"]');
      let probeLevel = '';
      probeRadios.forEach(r => { if (r.checked) probeLevel = r.value; });

      const qtyMill3 = intVal('qtyMill3');
      const qtyMill32 = intVal('qtyMill32');
      const qtyMill5 = intVal('qtyMill5');
      const qtyLathe2 = intVal('qtyLathe2');
      const qtyLatheY = intVal('qtyLatheY');
      const qtySwiss = intVal('qtySwiss');
      const qtyMultiTurret = intVal('qtyMultiTurret');
      const qtyWire2 = intVal('qtyWire2');
      const qtyWire4 = intVal('qtyWire4');

      return {
        qtyMill3, qtyMill32, qtyMill5,
        qtyLathe2, qtyLatheY, qtySwiss, qtyMultiTurret,
        qtyWire2, qtyWire4,
        // derivados
        hasMill3: qtyMill3 > 0,
        hasMill32: qtyMill32 > 0,
        hasMill5: qtyMill5 > 0,
        hasLathe2: qtyLathe2 > 0,
        hasLatheY: qtyLatheY > 0,
        hasSwiss: qtySwiss > 0,
        hasMultiTurret: qtyMultiTurret > 0,
        hasWire2: qtyWire2 > 0,
        hasWire4: qtyWire4 > 0,
        // tecnologías
        wantIM2D: document.getElementById('wantIM2D').checked,
        wantIM3D: document.getElementById('wantIM3D').checked,
        wantHSM3D: document.getElementById('wantHSM3D').checked,
        wantHSS: document.getElementById('wantHSS').checked,
        wantHSR: document.getElementById('wantHSR').checked,
        fiveAxisLevel: document.getElementById('fiveAxisLevel').value,
        wantRotary: false, // podrías agregarlo si lo necesitas
        probeLevel,
        wantMachineSim: document.getElementById('wantMachineSim').checked,
        wantFeatureRec: document.getElementById('wantFeatureRec').checked,
        wantCimco: document.getElementById('wantCimco').checked,
        wantOperators: document.getElementById('wantOperators').checked,
        wantFloating: document.getElementById('wantFloating').checked
      };
    }

    function recommendModules(data) {
      const modules = new Set();
      const anyMill = data.hasMill3 || data.hasMill32 || data.hasMill5;

      if (anyMill) {
        if (data.wantIM3D) {
          modules.add('milling_imach2d3d');
        } else if (data.wantIM2D) {
          modules.add('milling_imach2d');
        } else {
          modules.add('milling_25d');
        }

        if (data.wantHSM3D) modules.add('hsm3d');
        if (data.wantHSS) modules.add('hss');
        if (data.wantHSR) modules.add('hsr');

        if (data.hasMill32) modules.add('sim4');

        if (data.hasMill5 && data.fiveAxisLevel) {
          if (data.fiveAxisLevel === 'standard') modules.add('sim5_standard');
          if (data.fiveAxisLevel === 'pro') modules.add('sim5_pro');
          if (data.fiveAxisLevel === 'premium') modules.add('sim5_premium');
        }
      }

      if (data.wantFeatureRec) modules.add('feature_rec');

      if (data.hasLathe2 || data.hasLatheY || data.hasSwiss || data.hasMultiTurret) {
        modules.add('turning_core');
      }
      if (data.hasSwiss) {
        modules.add('swiss_type');
      }
      if (data.hasMultiTurret) {
        modules.add('multi_turret');
      }

      if (data.hasWire2 || data.hasWire4) {
        modules.add('dcam_standard');
      }

      if (data.probeLevel === 'l1') modules.add('probe_l1');
      if (data.probeLevel === 'l2') modules.add('probe_l2');

      if (data.wantMachineSim) modules.add('machine_sim');
      if (data.wantCimco) modules.add('cimco');
      if (data.wantOperators) {
        modules.add('operators_editor');
        modules.add('operators_sim');
      }
      if (data.wantFloating) modules.add('floating_cam');

      return Array.from(modules);
    }

    function recommendPosts(data) {
      const temp = [];

      if (data.qtyMill3 > 0) temp.push({ key: 'mill3', qty: data.qtyMill3 });
      if (data.qtyMill32 > 0) temp.push({ key: 'mill4', qty: data.qtyMill32 });
      if (data.qtyMill5 > 0) temp.push({ key: 'mill5', qty: data.qtyMill5 });

      if (data.qtyLathe2 > 0 || data.qtyLatheY > 0)
        temp.push({ key: 'turn', qty: data.qtyLathe2 + data.qtyLatheY });

      if (data.qtyLatheY > 0 || data.qtyMultiTurret > 0)
        temp.push({ key: 'millturn4', qty: data.qtyLatheY + data.qtyMultiTurret });

      if (data.qtySwiss > 0)
        temp.push({ key: 'millturn5', qty: data.qtySwiss });

      if (data.qtyWire2 > 0) temp.push({ key: 'wire2', qty: data.qtyWire2 });
      if (data.qtyWire4 > 0) temp.push({ key: 'wire4', qty: data.qtyWire4 });

      const map = new Map();
      temp.forEach(item => {
        const prev = map.get(item.key) || 0;
        map.set(item.key, prev + item.qty);
      });

      return Array.from(map.entries()).map(([key, qty]) => {
        const p = POST_TABLE[key];
        return {
          code: p.code,
          label: p.label,
          note: p.note,
          price: p.price,
          qty,
          subtotal: (p.price || 0) * qty
        };
      });
    }

    function recommendTraining(modules) {
      const mods = new Set(modules);
      const needed = new Set();

      if (mods.has('milling_25d') || mods.has('milling_imach2d') || mods.has('milling_imach2d3d')) {
        needed.add('workshop');
      }
      if (mods.has('sim4')) {
        needed.add('sim4_pkg');
        needed.add('idx4');
      }
      if (mods.has('sim5_standard') || mods.has('sim5_pro') || mods.has('sim5_premium')) {
        needed.add('sim5_pkg');
        needed.add('idx5');
      }
      if (mods.has('hsm3d') || mods.has('hsr')) {
        needed.add('hsm3d_hsr');
      }
      if (mods.has('hsr')) {
        needed.add('hsr');
      }
      if (mods.has('feature_rec')) {
        needed.add('feat');
      }

      return Array.from(needed).map(key => {
        const t = TRAINING_TABLE[key];
        return {
          code: t.code,
          label: t.label,
          price: t.price,
          qty: 1,
          subtotal: t.price
        };
      });
    }

    function renderPosts(posts) {
      const body = document.getElementById('postsBody');
      const totalCell = document.getElementById('postsTotal');
      if (!body || !totalCell) return;

      if (!posts.length) {
        body.innerHTML = '<tr><td colspan="6" class="px-2 py-2 text-center text-slate-400">Sin postprocesadores sugeridos.</td></tr>';
        totalCell.textContent = formatMoney(0);
        return;
      }

      let total = 0;
      body.innerHTML = posts.map(p => {
        total += p.subtotal || 0;
        return `
          <tr class="bg-base-700/60">
            <td class="px-2 py-1 text-left">${p.code}</td>
            <td class="px-2 py-1 text-left">${p.label}</td>
            <td class="px-2 py-1 text-right">${p.qty}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.price)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.subtotal)}</td>
            <td class="px-2 py-1 text-left text-xs">${p.note || ''}</td>
          </tr>
        `;
      }).join('');

      totalCell.textContent = formatMoney(total);
    }

    function renderTraining(trainings) {
      const body = document.getElementById('trainingBody');
      const totalCell = document.getElementById('trainingTotal');
      if (!body || !totalCell) return;

      if (!trainings.length) {
        body.innerHTML = '<tr><td colspan="5" class="px-2 py-2 text-center text-slate-400">Sin capacitaciones sugeridas.</td></tr>';
        totalCell.textContent = formatMoney(0);
        return;
      }

      let total = 0;
      body.innerHTML = trainings.map(t => {
        total += t.subtotal || 0;
        return `
          <tr class="bg-base-700/60">
            <td class="px-2 py-1 text-left">${t.code}</td>
            <td class="px-2 py-1 text-left">${t.label}</td>
            <td class="px-2 py-1 text-right">${t.qty}</td>
            <td class="px-2 py-1 text-right">${formatMoney(t.price)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(t.subtotal)}</td>
          </tr>
        `;
      }).join('');

      totalCell.textContent = formatMoney(total);
    }

    function renderResults(modules, data) {
      const resultsSection = document.getElementById('resultsSection');
      const modulesList = document.getElementById('modulesList');
      const pricingBody = document.getElementById('pricingBody');

      if (!modules.length) {
        resultsSection.classList.remove('hidden');
        modulesList.innerHTML = '<li class="text-sm text-amber-300">No hay máquinas ni tecnologías seleccionadas. Ingresa al menos una máquina.</li>';
        pricingBody.innerHTML = '';
        [
          'totLicense', 'totSubs1', 'totSubs3',
          'totLicSubs1', 'totLicSubs3',
          'totTrade2', 'totTrade3', 'totTerm', 'totCrm'
        ].forEach(id => document.getElementById(id).textContent = '');
        renderPosts([]);
        renderTraining([]);
        return;
      }

      modulesList.innerHTML = modules.map(id => {
        const p = PRICE_TABLE[id];
        return `<li>${p ? p.label : id}</li>`;
      }).join('');

      let tot = {
        license: 0, subs1: 0, subs3: 0,
        licSubs1: 0, licSubs3: 0,
        trade2: 0, trade3: 0, term: 0,
        crm: 0
      };

      pricingBody.innerHTML = modules.map(id => {
        const p = PRICE_TABLE[id];
        if (!p) return '';

        tot.license += p.license || 0;
        tot.subs1 += p.subs1 || 0;
        tot.subs3 += p.subs3 || 0;
        tot.licSubs1 += p.licSubs1 || 0;
        tot.licSubs3 += p.licSubs3 || 0;
        tot.trade2 += p.trade2 || 0;
        tot.trade3 += p.trade3 || 0;
        tot.term += p.term || 0;
        tot.crm += p.crmPrice || 0;

        return `
          <tr class="bg-base-700/60">
            <td class="px-2 py-1 text-left">${p.label}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.license)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.subs1)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.subs3)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.licSubs1)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.licSubs3)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.trade2)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.trade3)}</td>
            <td class="px-2 py-1 text-right">${formatMoney(p.term)}</td>
            <td class="px-2 py-1 text-left">${p.crmCode ? p.crmCode : '-'}</td>
            <td class="px-2 py-1 text-right">${p.crmPrice ? formatMoney(p.crmPrice) : '-'}</td>
          </tr>
        `;
      }).join('');

      document.getElementById('totLicense').textContent = formatMoney(tot.license);
      document.getElementById('totSubs1').textContent = formatMoney(tot.subs1);
      document.getElementById('totSubs3').textContent = formatMoney(tot.subs3);
      document.getElementById('totLicSubs1').textContent = formatMoney(tot.licSubs1);
      document.getElementById('totLicSubs3').textContent = formatMoney(tot.licSubs3);
      document.getElementById('totTrade2').textContent = formatMoney(tot.trade2);
      document.getElementById('totTrade3').textContent = formatMoney(tot.trade3);
      document.getElementById('totTerm').textContent = formatMoney(tot.term);
      document.getElementById('totCrm').textContent = formatMoney(tot.crm);

      // extras
      const posts = recommendPosts(data);
      const trainings = recommendTraining(modules);
      renderPosts(posts);
      renderTraining(trainings);

      resultsSection.classList.remove('hidden');
    }

    document.getElementById('calcBtn').addEventListener('click', () => {
      const data = collectFormData();
      const modules = recommendModules(data);
      renderResults(modules, data);
    });
  </script>
</body>
</html>
